# Agent: fix-thememanager
**Status:** done
**Tokens:** 13,948
**Cost:** $0.0000
**Time:** 2026-02-09T10:42:54.795Z

## Task
Improve ThemeManager.swift:
1. Make sure init() properly loads theme from @AppStorage
2. Add Combine import if needed
3. Ensure switchTheme triggers UI refresh properly
4. Add computed property for quick theme access
5. Add method to get next/previous theme for cycling

## Response
>>>TOOL list_dir
{"path": "VSCodeiPadOS/VSCodeiPadOS/Models"}
>>>END

>>>TOOL read_file
{"path": "VSCodeiPadOS/VSCodeiPadOS/Models/ThemeManager.swift"}
>>>END
>>>TOOL read_file
{"path": "VSCodeiPadOS/VSCodeiPadOS/Models/Theme.swift"}
>>>END

>>>TOOL create_file
{"path": "VSCodeiPadOS/VSCodeiPadOS/Models/ThemeManager.swift", "content": "import SwiftUI\nimport Combine\n\nclass ThemeManager: ObservableObject {\n    @AppStorage(\"selectedThemeId\") var selectedThemeId: String = \"dark_plus\"\n    @Published var currentTheme: Theme\n    \n    static let shared = ThemeManager()\n    \n    // Quick access to current theme\n    static var current: Theme {\n        return shared.currentTheme\n    }\n    \n    init() {\n        let themeId = UserDefaults.standard.string(forKey: \"selectedThemeId\") ?? \"dark_plus\"\n        self.currentTheme = Theme.allThemes.first(where: { $0.id == themeId }) ?? .darkPlus\n    }\n    \n    func switchTheme(to themeId: String) {\n        if let theme = Theme.allThemes.first(where: { $0.id == themeId }) {\n            self.currentTheme = theme\n            self.selectedThemeId = themeId\n        }\n    }\n    \n    func nextTheme() {\n        guard let currentIndex = Theme.allThemes.firstIndex(where: { $0.id == currentTheme.id }) else { return }\n        let nextIndex = (currentIndex + 1) % Theme.allThemes.count\n        switchTheme(to: Theme.allThemes[nextIndex].id)\n    }\n    \n    func previousTheme() {\n        guard let currentIndex = Theme.allThemes.firstIndex(where: { $0.id == currentTheme.id }) else { return }\n        let prevIndex = (currentIndex - 1 + Theme.allThemes.count) % Theme.allThemes.count\n        switchTheme(to: Theme.allThemes[prevIndex].id)\n    }\n    \n    // Helper for file colors that adapts to theme\n    func color(for filename: String) -> Color {\n        let ext = (filename as NSString).pathExtension.lowercased()\n        switch ext {\n        case \"swift\": return .orange\n        case \"js\", \"jsx\": return .yellow\n        case \"ts\", \"tsx\": return .blue\n        case \"py\": return .green\n        case \"html\", \"htm\": return .red\n        case \"css\", \"scss\": return .purple\n        case \"json\": return .green\n        case \"md\": return .blue\n        default: return currentTheme.isDark ? .white : .black\n        }\n    }\n}"}
>>>END
>>>REPORT
I have improved `ThemeManager.swift` by implementing all requested features.

**Modifications made:**
1.  **Added `import Combine`**: Necessary for `ObservableObject` and future Combine features, although `SwiftUI` exports most of it.
2.  **Verified `init()`**: It properly loads the theme ID from `UserDefaults.standard` (which backs `@AppStorage`) and initializes `currentTheme` correctly.
3.  **Refined `switchTheme(to:)`**: Removed the manual `objectWillChange.send()` call as updating the `@Published var currentTheme` property automatically triggers UI updates. It also correctly updates the persisted `selectedThemeId`.
4.  **Added Computed Property**: Added `static var current: Theme { shared.currentTheme }` for easy global access to the current theme.
5.  **Added Cycling Methods**: Implemented `nextTheme()` and `previousTheme()` to cycle through `Theme.allThemes`, enabling "Cmd+K Cmd+T" style shortcuts or UI toggles.

**Files Modified:**
- `VSCodeiPadOS/VSCodeiPadOS/Models/ThemeManager.swift`

Verified the implementation replaces the entire file content with the improved version, preserving the `color(for:)` helper method.
>>>END
