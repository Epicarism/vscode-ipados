# Agent: worker-go-c
**Status:** done
**Tokens:** 81,584
**Cost:** $0.0000
**Time:** 2026-02-09T11:03:29.933Z

## Task
Add syntax highlighting patterns for FEAT-020 Go and FEAT-021 C/C++/Objective-C in Extensions/NSAttributedStringSyntaxHighlighter.swift. Use gpt52 for regex patterns. Ensure required token categories.

## Response
>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift"} 
>>>END>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift"} 
>>>END

>>>TOOL search
{"query":"let cLikeStrings", "glob":"Extensions/NSAttributedStringSyntaxHighlighter.swift"} 
>>>END

>>>TOOL list_dir
{"path":"Extensions"} 
>>>END

>>>TOOL get_symbols
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift"} 
>>>END>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":120,"end_line":260} 
>>>END>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":185,"end_line":240} 
>>>END>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":420,"end_line":620} 
>>>END>>>END

>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":430,"end_line":520}
>>>END

>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":520,"end_line":760}
>>>END

>>>TOOL patch
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","find":"        // Numeric literal coverage (hex, float, exponent, underscores).\n        let commonNumber = \"\\\\b(?:0x[0-9A-Fa-f_]+|\\\\d[\\\\d_]*(?:\\\\.\\\\d[\\\\d_]*)?(?:[eE][+-]?\\\\d[\\\\d_]*)?)\\\\b\"\n\n        // C-like strings: \"...\" and '...'\n        let cLikeStrings = [\n            \"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\",\n            \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"\n        ]\n","replace":"        // Numeric literal coverage (hex, float, exponent, underscores).\n        let commonNumber = \"\\\\b(?:0x[0-9A-Fa-f_]+|\\\\d[\\\\d_]*(?:\\\\.\\\\d[\\\\d_]*)?(?:[eE][+-]?\\\\d[\\\\d_]*)?)\\\\b\"\n\n        // Go numeric literal coverage (binary/octal/hex, floats, hex floats, imaginary, underscores).\n        let goNumber = \"\\\\b(?:0[bB][01](?:_?[01])*|0[oO][0-7](?:_?[0-7])*|0[0-7](?:_?[0-7])*|0[xX][0-9A-Fa-f](?:_?[0-9A-Fa-f])*(?:\\\\.[0-9A-Fa-f](?:_?[0-9A-Fa-f])*)?(?:[pP][+-]?\\\\d(?:_?\\\\d)*)?|\\\\d(?:_?\\\\d)*(?:\\\\.\\\\d(?:_?\\\\d)*)?(?:[eE][+-]?\\\\d(?:_?\\\\d)*)?)(?:i)?\\\\b\"\n\n        // C/C++/ObjC numeric literal coverage (digit separators, bases, floats, suffixes).\n        let cFamilyNumber = \"\\\\b(?:0[xX][0-9A-Fa-f](?:[0-9A-Fa-f']*)|0[bB][01](?:[01']*)|0[0-7](?:[0-7']*)|\\\\d(?:[\\\\d']*))(?:\\\\.\\\\d(?:[\\\\d']*))?(?:[eEpP][+-]?\\\\d(?:[\\\\d']*))?(?:[uUlLfF]{0,4})\\\\b\"\n\n        // C-like strings: \"...\" and '...'\n        let cLikeStrings = [\n            \"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\",\n            \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"\n        ]\n\n        // C-family strings with common prefixes (C/C++/ObjC).\n        let cFamilyStrings = [\n            \"(?:u8|u|U|L)?\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\",\n            \"(?:u8|u|U|L)?'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"\n        ]\n\n        // C++ raw strings (R\\\"delim( ... )delim\\\"), including optional encoding prefix.\n        let cppRawString = \"(?:u8|u|U|L)?R\\\"([A-Za-z0-9_]{0,16})\\\\([\\\\s\\\\S]*?\\\\)\\\\1\\\"\"\n"} 
>>>END

>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":1,"end_line":1200}
>>>END

>>>TOOL create_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","content":"import SwiftUI\nimport UIKit\n\n// Efficient NSMutableAttributedString-based syntax highlighter (regex-based).\n//\n// VS Code Dark+ inspired color mapping:\n// - Keywords:   #569CD6\n// - Types:      #4EC9B0\n// - Strings:    #CE9178\n// - Comments:   #6A9955\n// - Numbers:    #B5CEA8\n// - Functions:  #DCDCAA\n// - Default:    #D4D4D4\nfinal class NSAttributedStringSyntaxHighlighter {\n\n    // MARK: - Language\n\n    // NOTE: This file cannot use the name `Language` because the project already defines a global `Language`\n    // enum elsewhere (VSCodeiPadOS/Views/Editor/SyntaxHighlightingTextView.swift).\n    enum SyntaxLanguage {\n        case swift, javascript, typescript, jsx, tsx\n        case python, ruby, go, rust\n        case java, kotlin\n        case c, cpp, objc\n        case html, css, scss\n        case json, xml, yaml\n        case sql, shell, dockerfile, graphql\n        case markdown, php, dotenv\n        case plainText\n    }\n\n    // MARK: - Colors (VS Code Dark+)\n\n    private extension UIColor {\n        convenience init(vscodeHex: UInt32, alpha: CGFloat = 1.0) {\n            let r = CGFloat((vscodeHex >> 16) & 0xFF) / 255.0\n            let g = CGFloat((vscodeHex >> 8) & 0xFF) / 255.0\n            let b = CGFloat(vscodeHex & 0xFF) / 255.0\n            self.init(red: r, green: g, blue: b, alpha: alpha)\n        }\n    }\n\n    private struct ColorScheme {\n        static let keyword = UIColor(vscodeHex: 0x569CD6)\n        static let type = UIColor(vscodeHex: 0x4EC9B0)\n        static let string = UIColor(vscodeHex: 0xCE9178)\n        static let comment = UIColor(vscodeHex: 0x6A9955)\n        static let number = UIColor(vscodeHex: 0xB5CEA8)\n        static let function = UIColor(vscodeHex: 0xDCDCAA)\n        static let defaultText = UIColor(vscodeHex: 0xD4D4D4)\n    }\n\n    // MARK: - Public API\n\n    /// Backwards-compatible entrypoint (defaults to Swift).\n    static func highlightCode(_ code: String) -> NSAttributedString {\n        highlightCode(code, filename: nil, language: .swift)\n    }\n\n    /// Highlights `code` using either an explicit `language` or a detected one from `filename`.\n    static func highlightCode(_ code: String, filename: String? = nil, language: SyntaxLanguage? = nil) -> NSAttributedString {\n        let attributed = NSMutableAttributedString(string: code)\n        let fullRange = NSRange(location: 0, length: code.utf16.count)\n\n        attributed.addAttributes([\n            .font: UIFont.monospacedSystemFont(ofSize: 14, weight: .regular),\n            .foregroundColor: ColorScheme.defaultText\n        ], range: fullRange)\n\n        let resolvedLanguage: SyntaxLanguage = {\n            if let language { return language }\n            if let filename { return detectLanguage(fromFilename: filename) }\n            return .plainText\n        }()\n\n        highlight(code: code, language: resolvedLanguage, into: attributed)\n        return attributed\n    }\n\n    // MARK: - Language detection\n\n    private static func detectLanguage(fromFilename filename: String) -> SyntaxLanguage {\n        let lower = filename.lowercased()\n        let base = (lower as NSString).lastPathComponent\n        let ext = (base as NSString).pathExtension\n\n        // Special basenames (no extension).\n        if base == \"dockerfile\" || base.hasPrefix(\"dockerfile.\") { return .dockerfile }\n        if base == \".env\" || base.hasPrefix(\".env.\") || ext == \"env\" { return .dotenv }\n\n        switch ext {\n        case \"swift\": return .swift\n        case \"js\", \"mjs\", \"cjs\": return .javascript\n        case \"jsx\": return .jsx\n        case \"ts\": return .typescript\n        case \"tsx\": return .tsx\n        case \"py\", \"pyw\": return .python\n        case \"rb\", \"ruby\": return .ruby\n        case \"go\": return .go\n        case \"rs\": return .rust\n        case \"java\": return .java\n        case \"kt\", \"kts\": return .kotlin\n        case \"c\": return .c\n        case \"cc\", \"cpp\", \"cxx\", \"hpp\", \"hh\", \"hxx\", \"h\": return .cpp\n        case \"m\", \"mm\": return .objc\n        case \"html\", \"htm\": return .html\n        case \"css\": return .css\n        case \"scss\", \"sass\": return .scss\n        case \"json\", \"jsonc\": return .json\n        case \"xml\", \"plist\", \"svg\": return .xml\n        case \"yml\", \"yaml\": return .yaml\n        case \"sql\": return .sql\n        case \"sh\", \"bash\", \"zsh\", \"fish\": return .shell\n        case \"php\": return .php\n        case \"gql\", \"graphql\": return .graphql\n        case \"md\", \"markdown\": return .markdown\n        default: return .plainText\n        }\n    }\n\n    // MARK: - Pipeline\n\n    private struct CapturePattern {\n        let pattern: String\n        let captureGroup: Int?\n        let options: NSRegularExpression.Options\n    }\n\n    private struct LanguageRules {\n        let keywords: [String]\n        let typePatterns: [CapturePattern]\n        let stringPatterns: [String]\n        let stringRegexOptions: NSRegularExpression.Options\n        let commentPatterns: [String]\n        let commentRegexOptions: NSRegularExpression.Options\n        let numberPattern: String?\n        let numberRegexOptions: NSRegularExpression.Options\n        let keywordRegexOptions: NSRegularExpression.Options\n        let functionPatterns: [CapturePattern]\n    }\n\n    private static func highlight(code: String, language: SyntaxLanguage, into attributed: NSMutableAttributedString) {\n        let rules = languageRules(for: language)\n\n        // 1) Strings first\n        let stringRanges = rules.stringPatterns.flatMap { pattern in\n            applyHighlighting(\n                pattern: pattern,\n                options: rules.stringRegexOptions,\n                color: ColorScheme.string,\n                to: attributed,\n                in: code,\n                captureGroup: nil,\n                excluding: []\n            )\n        }\n\n        // 2) Comments (exclude matches inside strings)\n        let commentRanges = rules.commentPatterns.flatMap { pattern in\n            applyHighlighting(\n                pattern: pattern,\n                options: rules.commentRegexOptions,\n                color: ColorScheme.comment,\n                to: attributed,\n                in: code,\n                captureGroup: nil,\n                excluding: stringRanges\n            )\n        }\n\n        let protectedRanges = stringRanges + commentRanges\n\n        // 3) Numbers\n        if let numberPattern = rules.numberPattern {\n            _ = applyHighlighting(\n                pattern: numberPattern,\n                options: rules.numberRegexOptions,\n                color: ColorScheme.number,\n                to: attributed,\n                in: code,\n                captureGroup: nil,\n                excluding: protectedRanges\n            )\n        }\n\n        // 4) Types\n        for typePattern in rules.typePatterns {\n            _ = applyHighlighting(\n                pattern: typePattern.pattern,\n                options: typePattern.options,\n                color: ColorScheme.type,\n                to: attributed,\n                in: code,\n                captureGroup: typePattern.captureGroup,\n                excluding: protectedRanges\n            )\n        }\n\n        // 5) Keywords\n        if !rules.keywords.isEmpty {\n            let keywordPattern = \"\\\\b(?:\" + rules.keywords.map(NSRegularExpression.escapedPattern).joined(separator: \"|\") + \")\\\\b\"\n            _ = applyHighlighting(\n                pattern: keywordPattern,\n                options: rules.keywordRegexOptions,\n                color: ColorScheme.keyword,\n                to: attributed,\n                in: code,\n                captureGroup: nil,\n                excluding: protectedRanges\n            )\n        }\n\n        // 6) Functions\n        for fnPattern in rules.functionPatterns {\n            _ = applyHighlighting(\n                pattern: fnPattern.pattern,\n                options: fnPattern.options,\n                color: ColorScheme.function,\n                to: attributed,\n                in: code,\n                captureGroup: fnPattern.captureGroup,\n                excluding: protectedRanges\n            )\n        }\n    }\n\n    // MARK: - Language rules\n\n    private static func languageRules(for language: SyntaxLanguage) -> LanguageRules {\n\n        // Default numeric literal coverage (hex, float, exponent, underscores).\n        // Individual languages override when needed (Swift / JS/TS / Python / Go / C-family).\n        let commonNumber = \"\\\\b(?:0x[0-9A-Fa-f_]+|\\\\d[\\\\d_]*(?:\\\\.\\\\d[\\\\d_]*)?(?:[eE][+-]?\\\\d[\\\\d_]*)?)\\\\b\"\n\n        // FEAT-020 Go numeric literals (gpt52):\n        // - binary/octal/hex/decimal integers (underscores)\n        // - decimal floats incl. leading-dot\n        // - hex floats (0x1.fp+3)\n        // - imaginary suffix i\n        let goNumber = \"\\\\b(?:0[bB][01](?:_?[01])*|0[oO][0-7](?:_?[0-7])*|0[xX][0-9A-Fa-f](?:_?[0-9A-Fa-f])*(?:\\\\.[0-9A-Fa-f](?:_?[0-9A-Fa-f])*)?(?:[pP][+-]?\\\\d(?:_?\\\\d)*)?|\\\\d(?:_?\\\\d)*(?:\\\\.\\\\d(?:_?\\\\d)*)?(?:[eE][+-]?\\\\d(?:_?\\\\d)*)?|\\\\.\\\\d(?:_?\\\\d)*(?:[eE][+-]?\\\\d(?:_?\\\\d)*)?)(?:i)?\\\\b\"\n\n        // FEAT-021 C/C++/ObjC numeric literals (gpt52):\n        // - binary (C++14), octal, hex\n        // - floats incl. exponent, hex-floats\n        // - digit separators (')\n        // - common suffixes (uUlLfF)\n        let cFamilyNumber = \"\\\\b(?:0[xX][0-9A-Fa-f](?:[0-9A-Fa-f']*)(?:\\\\.[0-9A-Fa-f']*)?(?:[pP][+-]?\\\\d(?:[\\\\d']*))?|0[bB][01](?:[01']*)|0[0-7](?:[0-7']*)|\\\\d(?:[\\\\d']*))(?:\\\\.\\\\d(?:[\\\\d']*))?(?:[eE][+-]?\\\\d(?:[\\\\d']*))?(?:[uUlLfF]{0,4})\\\\b\"\n\n        // C-like strings: \"...\" and '...'\n        let cLikeStrings = [\n            \"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\",\n            \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"\n        ]\n\n        // FEAT-021 C-family strings (gpt52): include common encoding prefixes.\n        let cFamilyStrings = [\n            \"(?:u8|u|U|L)?\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\",\n            \"(?:u8|u|U|L)?'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"\n        ]\n\n        // FEAT-021 C++ raw strings (gpt52): R\"delim( ... )delim\" (with optional encoding prefix).\n        let cppRawString = \"(?:u8|u|U|L)?R\\\"([A-Za-z0-9_]{0,16})\\\\([\\\\s\\\\S]*?\\\\)\\\\1\\\"\"\n\n        // C-like comments\n        let cLikeComments = [\n            \"//[^\\\\n]*\",\n            \"/\\\\*[\\\\s\\\\S]*?\\\\*/\"\n        ]\n\n        // Common function call: name(\n        let commonFunctionCall = CapturePattern(\n            pattern: \"\\\\b([A-Za-z_][A-Za-z0-9_]*)\\\\s*(?=\\\\()\",\n            captureGroup: 1,\n            options: []\n        )\n\n        switch language {\n\n        // MARK: Swift (patterns tuned)\n        case .swift:\n            // Swift numeric literals: hex/binary/octal, decimal, floats (underscores allowed).\n            let swiftNumber = \"\\\\b(?:0x[0-9A-Fa-f_]+(?:\\\\.[0-9A-Fa-f_]+)?(?:[pP][+-]?\\\\d[\\\\d_]*)?|0b[01_]+|0o[0-7_]+|\\\\d[\\\\d_]*(?:\\\\.\\\\d[\\\\d_]*)?(?:[eE][+-]?\\\\d[\\\\d_]*)?)\\\\b\"\n\n            // Swift strings: normal and raw (any number of # delimiters), including multiline triple-quoted.\n            let swiftStrings = [\n                \"#*\\\"\\\"\\\"[\\\\s\\\\S]*?\\\"\\\"\\\"#*\",\n                \"#*\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"#*\"\n            ]\n\n            return LanguageRules(\n                keywords: [\n                    \"func\", \"var\", \"let\", \"if\", \"else\", \"for\", \"while\", \"repeat\", \"switch\", \"case\", \"default\",\n                    \"return\", \"import\", \"class\", \"struct\", \"enum\", \"protocol\", \"extension\", \"actor\",\n                    \"private\", \"fileprivate\", \"public\", \"internal\", \"open\", \"static\", \"final\", \"override\",\n                    \"self\", \"super\", \"init\", \"deinit\",\n                    \"throw\", \"throws\", \"rethrows\", \"try\", \"catch\", \"do\", \"guard\", \"defer\",\n                    \"async\", \"await\",\n                    \"weak\", \"unowned\", \"mutating\", \"nonmutating\",\n                    \"typealias\", \"associatedtype\", \"where\", \"in\", \"is\", \"as\", \"Any\", \"some\", \"any\",\n                    \"true\", \"false\", \"nil\"\n                ],\n                typePatterns: [\n                    CapturePattern(\n                        pattern: \"\\\\b(?:String|Int|Int8|Int16|Int32|Int64|UInt|UInt8|UInt16|UInt32|UInt64|Double|Float|Bool|Character|Void|AnyObject|Never|Data|Date|URL|UUID|CGFloat)\\\\b\",\n                        captureGroup: nil,\n                        options: []\n                    ),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: swiftStrings,\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: swiftNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\bfunc\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        // MARK: JavaScript (patterns tuned)\n        case .javascript:\n            // JS numeric literals: hex/binary/octal/decimal/floats + BigInt suffix n.\n            let jsNumber = \"\\\\b(?:0x[0-9A-Fa-f_]+|0b[01_]+|0o[0-7_]+|\\\\d[\\\\d_]*(?:\\\\.\\\\d[\\\\d_]*)?(?:[eE][+-]?\\\\d[\\\\d_]*)?|\\\\d[\\\\d_]*n)\\\\b\"\n\n            return LanguageRules(\n                keywords: [\n                    \"break\", \"case\", \"catch\", \"class\", \"const\", \"continue\", \"debugger\", \"default\", \"delete\",\n                    \"do\", \"else\", \"export\", \"extends\", \"finally\", \"for\", \"function\", \"if\", \"import\", \"in\",\n                    \"instanceof\", \"let\", \"new\", \"return\", \"super\", \"switch\", \"this\", \"throw\", \"try\", \"typeof\",\n                    \"var\", \"void\", \"while\", \"with\", \"yield\", \"async\", \"await\", \"of\", \"true\", \"false\", \"null\", \"undefined\"\n                ],\n                typePatterns: [CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])],\n                stringPatterns: cLikeStrings + [\n                    \"`(?:[^`\\\\\\\\]|\\\\\\\\.|\\\\$\\\\{[\\\\s\\\\S]*?\\\\})*`\"\n                ],\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: jsNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\bfunction\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: []),\n                    CapturePattern(pattern: \"\\\\b(?:const|let|var)\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\s*=\\\\s*(?:async\\\\s*)?(?:\\\\([^)]*\\\\)|[A-Za-z_][A-Za-z0-9_]*)?\\\\s*=>\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        // MARK: TypeScript (patterns tuned)\n        case .typescript:\n            // TS shares JS numeric syntax.\n            let tsNumber = \"\\\\b(?:0x[0-9A-Fa-f_]+|0b[01_]+|0o[0-7_]+|\\\\d[\\\\d_]*(?:\\\\.\\\\d[\\\\d_]*)?(?:[eE][+-]?\\\\d[\\\\d_]*)?|\\\\d[\\\\d_]*n)\\\\b\"\n\n            return LanguageRules(\n                keywords: [\n                    // JS\n                    \"break\", \"case\", \"catch\", \"class\", \"const\", \"continue\", \"debugger\", \"default\", \"delete\",\n                    \"do\", \"else\", \"export\", \"extends\", \"finally\", \"for\", \"function\", \"if\", \"import\", \"in\",\n                    \"instanceof\", \"let\", \"new\", \"return\", \"super\", \"switch\", \"this\", \"throw\", \"try\", \"typeof\",\n                    \"var\", \"void\", \"while\", \"with\", \"yield\", \"async\", \"await\", \"of\", \"true\", \"false\", \"null\", \"undefined\",\n                    // TS\n                    \"interface\", \"type\", \"enum\", \"implements\", \"namespace\", \"abstract\", \"declare\", \"readonly\",\n                    \"private\", \"protected\", \"public\", \"keyof\", \"infer\", \"unknown\", \"never\", \"any\", \"as\", \"satisfies\"\n                ],\n                typePatterns: [\n                    CapturePattern(pattern: \"\\\\b(?:string|number|boolean|any|unknown|never|void|object|bigint|symbol)\\\\b\", captureGroup: nil, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: cLikeStrings + [\"`(?:[^`\\\\\\\\]|\\\\\\\\.|\\\\$\\\\{[\\\\s\\\\S]*?\\\\})*`\"],\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: tsNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\bfunction\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        case .tsx:\n            // TSX = TypeScript + JSX tags/attributes as \"types\" (cyan).\n            let ts = languageRules(for: .typescript)\n            return LanguageRules(\n                keywords: ts.keywords,\n                typePatterns: ts.typePatterns + [\n                    CapturePattern(pattern: \"<\\\\/?\\\\s*([A-Za-z][A-Za-z0-9:_-]*)\", captureGroup: 1, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Za-z_:][A-Za-z0-9:._-]*)(?=\\\\s*=)\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: ts.stringPatterns,\n                stringRegexOptions: ts.stringRegexOptions,\n                commentPatterns: ts.commentPatterns,\n                commentRegexOptions: ts.commentRegexOptions,\n                numberPattern: ts.numberPattern,\n                numberRegexOptions: ts.numberRegexOptions,\n                keywordRegexOptions: ts.keywordRegexOptions,\n                functionPatterns: ts.functionPatterns\n            )\n\n        case .jsx:\n            // JSX = JS plus tag/attribute as \"types\" for cyan.\n            let js = languageRules(for: .javascript)\n            return LanguageRules(\n                keywords: js.keywords,\n                typePatterns: js.typePatterns + [\n                    CapturePattern(pattern: \"<\\\\/?\\\\s*([A-Za-z][A-Za-z0-9:_-]*)\", captureGroup: 1, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Za-z_:][A-Za-z0-9:._-]*)(?=\\\\s*=)\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: js.stringPatterns,\n                stringRegexOptions: js.stringRegexOptions,\n                commentPatterns: js.commentPatterns,\n                commentRegexOptions: js.commentRegexOptions,\n                numberPattern: js.numberPattern,\n                numberRegexOptions: js.numberRegexOptions,\n                keywordRegexOptions: js.keywordRegexOptions,\n                functionPatterns: js.functionPatterns\n            )\n\n        // MARK: Python (patterns tuned)\n        case .python:\n            // Python numeric literals (underscores, hex/binary/octal, floats, leading-dot floats, complex).\n            let pyNumber = \"(?<!\\\\w)(?:(?:0x[0-9A-Fa-f_]+)|(?:0b[01_]+)|(?:0o[0-7_]+)|(?:\\\\d[\\\\d_]*(?:\\\\.\\\\d[\\\\d_]*)?(?:[eE][+-]?\\\\d[\\\\d_]*)?)|(?:\\\\.\\\\d[\\\\d_]*(?:[eE][+-]?\\\\d[\\\\d_]*)?))(?:[jJ])?(?!\\\\w)\"\n\n            // Python strings incl. optional prefixes before both single-line and triple-quoted strings.\n            let pyStrings = [\n                \"(?i)\\\\b(?:r|u|f|fr|rf|b|br|rb)?'''[\\\\s\\\\S]*?'''\",\n                \"(?i)\\\\b(?:r|u|f|fr|rf|b|br|rb)?\\\"\\\"\\\"[\\\\s\\\\S]*?\\\"\\\"\\\"\",\n                \"(?i)\\\\b(?:r|u|f|fr|rf|b|br|rb)?'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\",\n                \"(?i)\\\\b(?:r|u|f|fr|rf|b|br|rb)?\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\"\n            ]\n\n            return LanguageRules(\n                keywords: [\n                    \"False\", \"None\", \"True\", \"and\", \"as\", \"assert\", \"async\", \"await\", \"break\", \"class\",\n                    \"continue\", \"def\", \"del\", \"elif\", \"else\", \"except\", \"finally\", \"for\", \"from\", \"global\",\n                    \"if\", \"import\", \"in\", \"is\", \"lambda\", \"nonlocal\", \"not\", \"or\", \"pass\", \"raise\", \"return\",\n                    \"try\", \"while\", \"with\", \"yield\", \"match\", \"case\"\n                ],\n                typePatterns: [\n                    CapturePattern(pattern: \"\\\\b(?:int|float|bool|str|bytes|list|tuple|set|dict|object)\\\\b\", captureGroup: nil, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: pyStrings,\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: [\"#[^\\\\n]*\"],\n                commentRegexOptions: [],\n                numberPattern: pyNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\bdef\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        // ----- Everything below remains as previously defined (uses common patterns) -----\n\n        case .ruby:\n            return LanguageRules(\n                keywords: [\n                    \"BEGIN\", \"END\", \"alias\", \"and\", \"begin\", \"break\", \"case\", \"class\", \"def\", \"defined\\\\?\",\n                    \"do\", \"else\", \"elsif\", \"end\", \"ensure\", \"false\", \"for\", \"if\", \"in\", \"module\", \"next\",\n                    \"nil\", \"not\", \"or\", \"redo\", \"rescue\", \"retry\", \"return\", \"self\", \"super\", \"then\",\n                    \"true\", \"undef\", \"unless\", \"until\", \"when\", \"while\", \"yield\", \"private\", \"protected\", \"public\"\n                ],\n                typePatterns: [CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])],\n                stringPatterns: [\n                    \"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\",\n                    \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\",\n                    \"%[qQ]\\\\{[\\\\s\\\\S]*?\\\\}\",\n                    \"%[qQ]\\\\([\\\\s\\\\S]*?\\\\)\",\n                    \"%[qQ]\\\\[[\\\\s\\\\S]*?\\\\]\"\n                ],\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: [\"#[^\\\\n]*\", \"=begin[\\\\s\\\\S]*?=end\"],\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: commonNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\bdef\\\\s+([A-Za-z_][A-Za-z0-9_]*[!?=]?)\\\\b\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        case .go:\n            // FEAT-020 Go (gpt52 regex patterns)\n            return LanguageRules(\n                keywords: [\n                    \"break\", \"default\", \"func\", \"interface\", \"select\", \"case\", \"defer\", \"go\", \"map\", \"struct\",\n                    \"chan\", \"else\", \"goto\", \"package\", \"switch\", \"const\", \"fallthrough\", \"if\", \"range\", \"type\",\n                    \"continue\", \"for\", \"import\", \"return\", \"var\", \"true\", \"false\", \"nil\"\n                ],\n                typePatterns: [\n                    CapturePattern(\n                        pattern: \"\\\\b(?:any|comparable|string|bool|byte|rune|int|int8|int16|int32|int64|uint|uint8|uint16|uint32|uint64|uintptr|float32|float64|complex64|complex128|error)\\\\b\",\n                        captureGroup: nil,\n                        options: []\n                    ),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: [\n                    // Raw string literals\n                    \"`[\\\\s\\\\S]*?`\",\n                    // Interpreted string literals (common escapes)\n                    \"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\(?:[abfnrtv\\\\\\\\\\\"']|x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8}|[0-7]{1,3}))*\\\"\",\n                    // Rune literals (single quotes)\n                    \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\(?:[abfnrtv\\\\\\\\\\\"']|x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8}|[0-7]{1,3}))*'\"\n                ],\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: goNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    // func Name(...) / func (r Receiver) Name(...)\n                    CapturePattern(pattern: \"\\\\bfunc\\\\s+(?:\\\\([^)]*\\\\)\\\\s*)?([A-Za-z_][A-Za-z0-9_]*)\\\\s*\\\\(\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        case .rust:\n            // FEAT-019 Rust (gpt52 regex patterns)\n            let rustNumber = \"\\\\b(?:0b[01_]+|0o[0-7_]+|0x[0-9A-Fa-f_]+|\\\\d[\\\\d_]*(?:\\\\.\\\\d[\\\\d_]*)?(?:[eE][+-]?\\\\d[\\\\d_]*)?)(?:u(?:8|16|32|64|128|size)|i(?:8|16|32|64|128|size)|f(?:32|64))?\\\\b\"\n            return LanguageRules(\n                keywords: [\n                    // Strict/used keywords\n                    \"as\", \"break\", \"const\", \"continue\", \"crate\", \"else\", \"enum\", \"extern\", \"false\", \"fn\", \"for\",\n                    \"if\", \"impl\", \"in\", \"let\", \"loop\", \"match\", \"mod\", \"move\", \"mut\", \"pub\", \"ref\", \"return\",\n                    \"self\", \"Self\", \"static\", \"struct\", \"super\", \"trait\", \"true\", \"type\", \"unsafe\", \"use\",\n                    \"where\", \"while\", \"async\", \"await\", \"dyn\",\n                    // Common/reserved (best-effort)\n                    \"union\", \"macro_rules\", \"yield\", \"try\", \"box\", \"abstract\", \"become\", \"do\", \"final\", \"override\",\n                    \"priv\", \"typeof\", \"unsized\", \"virtual\"\n                ],\n                typePatterns: [\n                    // Primitive + common std/core types\n                    CapturePattern(\n                        pattern: \"\\\\b(?:i8|i16|i32|i64|i128|isize|u8|u16|u32|u64|u128|usize|f32|f64|bool|char|str|String|Option|Result|Vec|Box|Rc|Arc|HashMap|HashSet|BTreeMap|BTreeSet)\\\\b\",\n                        captureGroup: nil,\n                        options: []\n                    ),\n                    // Lifetimes: 'a, 'static (avoid matching char literals like 'a')\n                    CapturePattern(pattern: \"\\\\B'([A-Za-z_][A-Za-z0-9_]*)(?!')\", captureGroup: 1, options: []),\n                    // UpperCamelCase identifiers\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: [\n                    // Raw strings: r\"...\" / r#\"...\"# / r##\"...\"## etc\n                    \"r(#*)\\\"[\\\\s\\\\S]*?\\\"\\\\1\",\n                    // Byte raw strings: br\"...\" / br#\"...\"# / ...\n                    \"br(#*)\\\"[\\\\s\\\\S]*?\\\"\\\\1\",\n                    // Byte strings / byte chars\n                    \"b\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\",\n                    \"b'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\",\n                    // Normal strings / chars\n                    \"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\",\n                    \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"\n                ],\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: [\n                    // Line + block comments (including doc comments) - best-effort\n                    \"//[^\\\\n]*\",\n                    \"/\\\\*[\\\\s\\\\S]*?\\\\*/\"\n                ],\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: rustNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    // Function definitions\n                    CapturePattern(pattern: \"\\\\bfn\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: []),\n                    // Macro invocations: println!(...), vec![...]\n                    CapturePattern(pattern: \"\\\\b([A-Za-z_][A-Za-z0-9_]*)!\\\\s*(?=\\\\()\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        case .java:\n            return LanguageRules(\n                keywords: [\n                    \"abstract\", \"assert\", \"boolean\", \"break\", \"byte\", \"case\", \"catch\", \"char\", \"class\",\n                    \"const\", \"continue\", \"default\", \"do\", \"double\", \"else\", \"enum\", \"extends\", \"final\",\n                    \"finally\", \"float\", \"for\", \"goto\", \"if\", \"implements\", \"import\", \"instanceof\", \"int\",\n                    \"interface\", \"long\", \"native\", \"new\", \"package\", \"private\", \"protected\", \"public\",\n                    \"return\", \"short\", \"static\", \"strictfp\", \"super\", \"switch\", \"synchronized\", \"this\",\n                    \"throw\", \"throws\", \"transient\", \"try\", \"void\", \"volatile\", \"while\", \"true\", \"false\", \"null\",\n                    \"var\", \"record\", \"sealed\", \"permits\", \"non-sealed\"\n                ],\n                typePatterns: [\n                    CapturePattern(pattern: \"\\\\b(?:boolean|byte|char|short|int|long|float|double|void|String|Object)\\\\b\", captureGroup: nil, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: cLikeStrings,\n                stringRegexOptions: [],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: commonNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [commonFunctionCall]\n            )\n\n        case .kotlin:\n            return LanguageRules(\n                keywords: [\n                    \"as\", \"break\", \"class\", \"continue\", \"do\", \"else\", \"false\", \"for\", \"fun\", \"if\", \"in\",\n                    \"interface\", \"is\", \"null\", \"object\", \"package\", \"return\", \"super\", \"this\", \"throw\",\n                    \"true\", \"try\", \"typealias\", \"val\", \"var\", \"when\", \"while\",\n                    \"by\", \"catch\", \"constructor\", \"delegate\", \"finally\", \"get\", \"import\", \"init\", \"set\", \"where\",\n                    \"actual\", \"abstract\", \"annotation\", \"companion\", \"const\", \"crossinline\", \"data\", \"enum\",\n                    \"expect\", \"external\", \"final\", \"infix\", \"inline\", \"inner\", \"internal\", \"lateinit\",\n                    \"noinline\", \"open\", \"operator\", \"out\", \"override\", \"private\", \"protected\", \"public\",\n                    \"reified\", \"sealed\", \"suspend\", \"tailrec\", \"vararg\"\n                ],\n                typePatterns: [\n                    CapturePattern(pattern: \"\\\\b(?:Int|Long|Short|Byte|Float|Double|Boolean|Char|String|Unit|Any|Nothing)\\\\b\", captureGroup: nil, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: [\"\\\"\\\"\\\"[\\\\s\\\\S]*?\\\"\\\"\\\"\", \"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\", \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"],\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: commonNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\bfun\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        case .c:\n            // FEAT-021 C (gpt52 regex patterns)\n            return LanguageRules(\n                keywords: [\n                    \"auto\", \"break\", \"case\", \"char\", \"const\", \"continue\", \"default\", \"do\", \"double\", \"else\",\n                    \"enum\", \"extern\", \"float\", \"for\", \"goto\", \"if\", \"inline\", \"int\", \"long\", \"register\",\n                    \"restrict\", \"return\", \"short\", \"signed\", \"sizeof\", \"static\", \"struct\", \"switch\", \"typedef\",\n                    \"union\", \"unsigned\", \"void\", \"volatile\", \"while\", \"_Bool\", \"_Complex\", \"_Imaginary\"\n                ],\n                typePatterns: [\n                    CapturePattern(\n                        pattern: \"\\\\b(?:void|bool|char|short|int|long|float|double|size_t|ssize_t|ptrdiff_t|int8_t|uint8_t|int16_t|uint16_t|int32_t|uint32_t|int64_t|uint64_t|intptr_t|uintptr_t)\\\\b\",\n                        captureGroup: nil,\n                        options: []\n                    ),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: cFamilyStrings,\n                stringRegexOptions: [],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: cFamilyNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [commonFunctionCall]\n            )\n\n        case .cpp:\n            // FEAT-021 C++ (gpt52 regex patterns)\n            return LanguageRules(\n                keywords: [\n                    \"alignas\", \"alignof\", \"and\", \"and_eq\", \"asm\", \"auto\", \"bitand\", \"bitor\", \"bool\", \"break\",\n                    \"case\", \"catch\", \"char\", \"char8_t\", \"char16_t\", \"char32_t\", \"class\", \"compl\", \"concept\",\n                    \"const\", \"consteval\", \"constexpr\", \"constinit\", \"continue\", \"co_await\", \"co_return\", \"co_yield\",\n                    \"default\", \"delete\", \"do\", \"double\", \"dynamic_cast\", \"else\", \"enum\", \"explicit\", \"export\", \"extern\",\n                    \"false\", \"float\", \"for\", \"friend\", \"goto\", \"if\", \"inline\", \"int\", \"long\", \"mutable\", \"namespace\",\n                    \"new\", \"noexcept\", \"not\", \"not_eq\", \"nullptr\", \"operator\", \"or\", \"or_eq\", \"private\", \"protected\",\n                    \"public\", \"register\", \"reinterpret_cast\", \"requires\", \"return\", \"short\", \"signed\", \"sizeof\",\n                    \"static\", \"static_assert\", \"static_cast\", \"struct\", \"switch\", \"template\", \"this\", \"thread_local\",\n                    \"throw\", \"true\", \"try\", \"typedef\", \"typeid\", \"typename\", \"union\", \"unsigned\", \"using\", \"virtual\",\n                    \"void\", \"volatile\", \"wchar_t\", \"while\", \"xor\", \"xor_eq\", \"final\", \"override\"\n                ],\n                typePatterns: [\n                    CapturePattern(\n                        pattern: \"\\\\b(?:void|bool|char|short|int|long|float|double|wchar_t|char8_t|char16_t|char32_t|size_t|ssize_t|ptrdiff_t|nullptr_t|int8_t|uint8_t|int16_t|uint16_t|int32_t|uint32_t|int64_t|uint64_t|intptr_t|uintptr_t|string|string_view|std::[A-Za-z0-9_:]+)\\\\b\",\n                        captureGroup: nil,\n                        options: []\n                    ),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: [cppRawString] + cFamilyStrings,\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: cFamilyNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [commonFunctionCall]\n            )\n\n        case .objc:\n            // FEAT-021 Objective-C (gpt52 regex patterns)\n            return LanguageRules(\n                keywords: [\n                    \"@interface\", \"@implementation\", \"@end\", \"@property\", \"@synthesize\", \"@dynamic\", \"@protocol\",\n                    \"@class\", \"@public\", \"@private\", \"@protected\", \"@package\",\n                    \"@try\", \"@catch\", \"@finally\", \"@throw\", \"@autoreleasepool\",\n                    \"@selector\", \"@encode\", \"@import\", \"@available\",\n                    \"if\", \"else\", \"for\", \"while\", \"switch\", \"

>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":850,"end_line":1150}
>>>END

>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":1,"end_line":260}
>>>END

>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":1,"end_line":50}
>>>END



>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":1,"end_line":5}
>>>END

>>>TOOL read_file
{"path":"VSCodeiPadOS/VSCodeiPadOS/Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":1,"end_line":1200}
>>>END

>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":1,"end_line":200}
>>>END

>>>TOOL create_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","content":"import SwiftUI\nimport UIKit\n\n// Efficient NSMutableAttributedString-based syntax highlighter (regex-based).\n//\n// VS Code Dark+ inspired color mapping:\n// - Keywords:   #569CD6\n// - Types:      #4EC9B0\n// - Strings:    #CE9178\n// - Comments:   #6A9955\n// - Numbers:    #B5CEA8\n// - Functions:  #DCDCAA\n// - Default:    #D4D4D4\nfinal class NSAttributedStringSyntaxHighlighter {\n\n    // MARK: - Language\n\n    // NOTE: This file cannot use the name `Language` because the project already defines a global `Language`\n    // enum elsewhere (VSCodeiPadOS/Views/Editor/SyntaxHighlightingTextView.swift).\n    enum SyntaxLanguage {\n        case swift, javascript, typescript, jsx, tsx\n        case python, ruby, go, rust\n        case java, kotlin\n        case c, cpp, objc\n        case html, css, scss\n        case json, xml, yaml\n        case sql, shell, dockerfile, graphql\n        case markdown, php, dotenv\n        case plainText\n    }\n\n    // MARK: - Colors (VS Code Dark+)\n\n    private extension UIColor {\n        convenience init(vscodeHex: UInt32, alpha: CGFloat = 1.0) {\n            let r = CGFloat((vscodeHex >> 16) & 0xFF) / 255.0\n            let g = CGFloat((vscodeHex >> 8) & 0xFF) / 255.0\n            let b = CGFloat(vscodeHex & 0xFF) / 255.0\n            self.init(red: r, green: g, blue: b, alpha: alpha)\n        }\n    }\n\n    private struct ColorScheme {\n        static let keyword = UIColor(vscodeHex: 0x569CD6)\n        static let type = UIColor(vscodeHex: 0x4EC9B0)\n        static let string = UIColor(vscodeHex: 0xCE9178)\n        static let comment = UIColor(vscodeHex: 0x6A9955)\n        static let number = UIColor(vscodeHex: 0xB5CEA8)\n        static let function = UIColor(vscodeHex: 0xDCDCAA)\n        static let defaultText = UIColor(vscodeHex: 0xD4D4D4)\n    }\n\n    // MARK: - Public API\n\n    /// Backwards-compatible entrypoint (defaults to Swift).\n    static func highlightCode(_ code: String) -> NSAttributedString {\n        highlightCode(code, filename: nil, language: .swift)\n    }\n\n    /// Highlights `code` using either an explicit `language` or a detected one from `filename`.\n    static func highlightCode(_ code: String, filename: String? = nil, language: SyntaxLanguage? = nil) -> NSAttributedString {\n        let attributed = NSMutableAttributedString(string: code)\n        let fullRange = NSRange(location: 0, length: code.utf16.count)\n\n        attributed.addAttributes([\n            .font: UIFont.monospacedSystemFont(ofSize: 14, weight: .regular),\n            .foregroundColor: ColorScheme.defaultText\n        ], range: fullRange)\n\n        let resolvedLanguage: SyntaxLanguage = {\n            if let language { return language }\n            if let filename { return detectLanguage(fromFilename: filename) }\n            return .plainText\n        }()\n\n        highlight(code: code, language: resolvedLanguage, into: attributed)\n        return attributed\n    }\n\n    // MARK: - Language detection\n\n    private static func detectLanguage(fromFilename filename: String) -> SyntaxLanguage {\n        let lower = filename.lowercased()\n        let base = (lower as NSString).lastPathComponent\n        let ext = (base as NSString).pathExtension\n\n        // Special basenames (no extension).\n        if base == \"dockerfile\" || base.hasPrefix(\"dockerfile.\") { return .dockerfile }\n        if base == \".env\" || base.hasPrefix(\".env.\") || ext == \"env\" { return .dotenv }\n\n        switch ext {\n        case \"swift\": return .swift\n        case \"js\", \"mjs\", \"cjs\": return .javascript\n        case \"jsx\": return .jsx\n        case \"ts\": return .typescript\n        case \"tsx\": return .tsx\n        case \"py\", \"pyw\": return .python\n        case \"rb\", \"ruby\": return .ruby\n        case \"go\": return .go\n        case \"rs\": return .rust\n        case \"java\": return .java\n        case \"kt\", \"kts\": return .kotlin\n        case \"c\": return .c\n        case \"cc\", \"cpp\", \"cxx\", \"hpp\", \"hh\", \"hxx\", \"h\": return .cpp\n        case \"m\", \"mm\": return .objc\n        case \"html\", \"htm\": return .html\n        case \"css\": return .css\n        case \"scss\", \"sass\": return .scss\n        case \"json\", \"jsonc\": return .json\n        case \"xml\", \"plist\", \"svg\": return .xml\n        case \"yml\", \"yaml\": return .yaml\n        case \"sql\": return .sql\n        case \"sh\", \"bash\", \"zsh\", \"fish\": return .shell\n        case \"php\": return .php\n        case \"gql\", \"graphql\": return .graphql\n        case \"md\", \"markdown\": return .markdown\n        default: return .plainText\n        }\n    }\n\n    // MARK: - Pipeline\n\n    private struct CapturePattern {\n        let pattern: String\n        let captureGroup: Int?\n        let options: NSRegularExpression.Options\n    }\n\n    private struct LanguageRules {\n        let keywords: [String]\n        let typePatterns: [CapturePattern]\n        let stringPatterns: [String]\n        let stringRegexOptions: NSRegularExpression.Options\n        let commentPatterns: [String]\n        let commentRegexOptions: NSRegularExpression.Options\n        let numberPattern: String?\n        let numberRegexOptions: NSRegularExpression.Options\n        let keywordRegexOptions: NSRegularExpression.Options\n        let functionPatterns: [CapturePattern]\n    }\n\n    private static func highlight(code: String, language: SyntaxLanguage, into attributed: NSMutableAttributedString) {\n        let rules = languageRules(for: language)\n\n        // 1) Strings first\n        let stringRanges = rules.stringPatterns.flatMap { pattern in\n            applyHighlighting(\n                pattern: pattern,\n                options: rules.stringRegexOptions,\n                color: ColorScheme.string,\n                to: attributed,\n                in: code,\n                captureGroup: nil,\n                excluding: []\n            )\n        }\n\n        // 2) Comments (exclude matches inside strings)\n        let commentRanges = rules.commentPatterns.flatMap { pattern in\n            applyHighlighting(\n                pattern: pattern,\n                options: rules.commentRegexOptions,\n                color: ColorScheme.comment,\n                to: attributed,\n                in: code,\n                captureGroup: nil,\n                excluding: stringRanges\n            )\n        }\n\n        let protectedRanges = stringRanges + commentRanges\n\n        // 3) Numbers\n        if let numberPattern = rules.numberPattern {\n            _ = applyHighlighting(\n                pattern: numberPattern,\n                options: rules.numberRegexOptions,\n                color: ColorScheme.number,\n                to: attributed,\n                in: code,\n                captureGroup: nil,\n                excluding: protectedRanges\n            )\n        }\n\n        // 4) Types\n        for typePattern in rules.typePatterns {\n            _ = applyHighlighting(\n                pattern: typePattern.pattern,\n                options: typePattern.options,\n                color: ColorScheme.type,\n                to: attributed,\n                in: code,\n                captureGroup: typePattern.captureGroup,\n                excluding: protectedRanges\n            )\n        }\n\n        // 5) Keywords\n        if !rules.keywords.isEmpty {\n            let keywordPattern = \"\\\\b(?:\" + rules.keywords.map(NSRegularExpression.escapedPattern).joined(separator: \"|\") + \")\\\\b\"\n            _ = applyHighlighting(\n                pattern: keywordPattern,\n                options: rules.keywordRegexOptions,\n                color: ColorScheme.keyword,\n                to: attributed,\n                in: code,\n                captureGroup: nil,\n                excluding: protectedRanges\n            )\n        }\n\n        // 6) Functions\n        for fnPattern in rules.functionPatterns {\n            _ = applyHighlighting(\n                pattern: fnPattern.pattern,\n                options: fnPattern.options,\n                color: ColorScheme.function,\n                to: attributed,\n                in: code,\n                captureGroup: fnPattern.captureGroup,\n                excluding: protectedRanges\n            )\n        }\n    }\n\n    // MARK: - Language rules\n\n    private static func languageRules(for language: SyntaxLanguage) -> LanguageRules {\n\n        // Default numeric literal coverage (hex, float, exponent, underscores).\n        let commonNumber = \"\\\\b(?:0x[0-9A-Fa-f_]+|\\\\d[\\\\d_]*(?:\\\\.\\\\d[\\\\d_]*)?(?:[eE][+-]?\\\\d[\\\\d_]*)?)\\\\b\"\n\n        // FEAT-020 Go numeric literals (gpt52):\n        // - binary/octal/hex/decimal integers (underscores)\n        // - decimal floats incl. leading-dot\n        // - hex floats (0x1.fp+3)\n        // - optional imaginary suffix i\n        let goNumber = \"\\\\b(?:0[bB][01](?:_?[01])*|0[oO][0-7](?:_?[0-7])*|0[xX][0-9A-Fa-f](?:_?[0-9A-Fa-f])*(?:\\\\.[0-9A-Fa-f](?:_?[0-9A-Fa-f])*)?(?:[pP][+-]?\\\\d(?:_?\\\\d)*)?|\\\\d(?:_?\\\\d)*(?:\\\\.\\\\d(?:_?\\\\d)*)?(?:[eE][+-]?\\\\d(?:_?\\\\d)*)?|\\\\.\\\\d(?:_?\\\\d)*(?:[eE][+-]?\\\\d(?:_?\\\\d)*)?)(?:i)?\\\\b\"\n\n        // FEAT-021 C/C++/ObjC numeric literals (gpt52):\n        // - binary (C++14), octal, hex, decimal\n        // - floats incl. exponent, hex-floats\n        // - digit separators (')\n        // - common suffixes (uUlLfF)\n        let cFamilyNumber = \"\\\\b(?:0[xX][0-9A-Fa-f](?:[0-9A-Fa-f']*)(?:\\\\.[0-9A-Fa-f']*)?(?:[pP][+-]?\\\\d(?:[\\\\d']*))?|0[bB][01](?:[01']*)|0[0-7](?:[0-7']*)|\\\\d(?:[\\\\d']*))(?:\\\\.\\\\d(?:[\\\\d']*))?(?:[eE][+-]?\\\\d(?:[\\\\d']*))?(?:[uUlLfF]{0,4})\\\\b\"\n\n        let cLikeStrings = [\n            \"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\",\n            \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"\n        ]\n\n        // FEAT-021 C-family strings (gpt52): include common encoding prefixes.\n        let cFamilyStrings = [\n            \"(?:u8|u|U|L)?\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\",\n            \"(?:u8|u|U|L)?'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"\n        ]\n\n        // FEAT-021 C++ raw strings (gpt52): R\"delim( ... )delim\" (with optional encoding prefix).\n        let cppRawString = \"(?:u8|u|U|L)?R\\\"([A-Za-z0-9_]{0,16})\\\\([\\\\s\\\\S]*?\\\\)\\\\1\\\"\"\n\n        let cLikeComments = [\n            \"//[^\\\\n]*\",\n            \"/\\\\*[\\\\s\\\\S]*?\\\\*/\"\n        ]\n\n        // Common function call: name(\n        let commonFunctionCall = CapturePattern(\n            pattern: \"\\\\b([A-Za-z_][A-Za-z0-9_]*)\\\\s*(?=\\\\()\",\n            captureGroup: 1,\n            options: []\n        )\n\n        switch language {\n        case .swift:\n            let swiftNumber = \"\\\\b(?:0x[0-9A-Fa-f_]+(?:\\\\.[0-9A-Fa-f_]+)?(?:[pP][+-]?\\\\d[\\\\d_]*)?|0b[01_]+|0o[0-7_]+|\\\\d[\\\\d_]*(?:\\\\.\\\\d[\\\\d_]*)?(?:[eE][+-]?\\\\d[\\\\d_]*)?)\\\\b\"\n            let swiftStrings = [\n                \"#*\\\"\\\"\\\"[\\\\s\\\\S]*?\\\"\\\"\\\"#*\",\n                \"#*\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"#*\"\n            ]\n            return LanguageRules(\n                keywords: [\n                    \"func\", \"var\", \"let\", \"if\", \"else\", \"for\", \"while\", \"repeat\", \"switch\", \"case\", \"default\",\n                    \"return\", \"import\", \"class\", \"struct\", \"enum\", \"protocol\", \"extension\", \"actor\",\n                    \"private\", \"fileprivate\", \"public\", \"internal\", \"open\", \"static\", \"final\", \"override\",\n                    \"self\", \"super\", \"init\", \"deinit\",\n                    \"throw\", \"throws\", \"rethrows\", \"try\", \"catch\", \"do\", \"guard\", \"defer\",\n                    \"async\", \"await\",\n                    \"weak\", \"unowned\", \"mutating\", \"nonmutating\",\n                    \"typealias\", \"associatedtype\", \"where\", \"in\", \"is\", \"as\", \"Any\", \"some\", \"any\",\n                    \"true\", \"false\", \"nil\"\n                ],\n                typePatterns: [\n                    CapturePattern(pattern: \"\\\\b(?:String|Int|Int8|Int16|Int32|Int64|UInt|UInt8|UInt16|UInt32|UInt64|Double|Float|Bool|Character|Void|AnyObject|Never|Data|Date|URL|UUID|CGFloat)\\\\b\", captureGroup: nil, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: swiftStrings,\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: swiftNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\bfunc\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        case .javascript:\n            let jsNumber = \"\\\\b(?:0x[0-9A-Fa-f_]+|0b[01_]+|0o[0-7_]+|\\\\d[\\\\d_]*(?:\\\\.\\\\d[\\\\d_]*)?(?:[eE][+-]?\\\\d[\\\\d_]*)?|\\\\d[\\\\d_]*n)\\\\b\"\n            return LanguageRules(\n                keywords: [\n                    \"break\", \"case\", \"catch\", \"class\", \"const\", \"continue\", \"debugger\", \"default\", \"delete\",\n                    \"do\", \"else\", \"export\", \"extends\", \"finally\", \"for\", \"function\", \"if\", \"import\", \"in\",\n                    \"instanceof\", \"let\", \"new\", \"return\", \"super\", \"switch\", \"this\", \"throw\", \"try\", \"typeof\",\n                    \"var\", \"void\", \"while\", \"with\", \"yield\", \"async\", \"await\", \"of\", \"true\", \"false\", \"null\", \"undefined\"\n                ],\n                typePatterns: [CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])],\n                stringPatterns: cLikeStrings + [\"`(?:[^`\\\\\\\\]|\\\\\\\\.|\\\\$\\\\{[\\\\s\\\\S]*?\\\\})*`\"],\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: jsNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\bfunction\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: []),\n                    CapturePattern(pattern: \"\\\\b(?:const|let|var)\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\s*=\\\\s*(?:async\\\\s*)?(?:\\\\([^)]*\\\\)|[A-Za-z_][A-Za-z0-9_]*)?\\\\s*=>\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        case .typescript:\n            let tsNumber = \"\\\\b(?:0x[0-9A-Fa-f_]+|0b[01_]+|0o[0-7_]+|\\\\d[\\\\d_]*(?:\\\\.\\\\d[\\\\d_]*)?(?:[eE][+-]?\\\\d[\\\\d_]*)?|\\\\d[\\\\d_]*n)\\\\b\"\n            return LanguageRules(\n                keywords: [\n                    \"break\", \"case\", \"catch\", \"class\", \"const\", \"continue\", \"debugger\", \"default\", \"delete\",\n                    \"do\", \"else\", \"export\", \"extends\", \"finally\", \"for\", \"function\", \"if\", \"import\", \"in\",\n                    \"instanceof\", \"let\", \"new\", \"return\", \"super\", \"switch\", \"this\", \"throw\", \"try\", \"typeof\",\n                    \"var\", \"void\", \"while\", \"with\", \"yield\", \"async\", \"await\", \"of\", \"true\", \"false\", \"null\", \"undefined\",\n                    \"interface\", \"type\", \"enum\", \"implements\", \"namespace\", \"abstract\", \"declare\", \"readonly\",\n                    \"private\", \"protected\", \"public\", \"keyof\", \"infer\", \"unknown\", \"never\", \"any\", \"as\", \"satisfies\"\n                ],\n                typePatterns: [\n                    CapturePattern(pattern: \"\\\\b(?:string|number|boolean|any|unknown|never|void|object|bigint|symbol)\\\\b\", captureGroup: nil, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: cLikeStrings + [\"`(?:[^`\\\\\\\\]|\\\\\\\\.|\\\\$\\\\{[\\\\s\\\\S]*?\\\\})*`\"],\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: tsNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\bfunction\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        case .tsx:\n            let ts = languageRules(for: .typescript)\n            return LanguageRules(\n                keywords: ts.keywords,\n                typePatterns: ts.typePatterns + [\n                    CapturePattern(pattern: \"<\\\\/?\\\\s*([A-Za-z][A-Za-z0-9:_-]*)\", captureGroup: 1, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Za-z_:][A-Za-z0-9:._-]*)(?=\\\\s*=)\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: ts.stringPatterns,\n                stringRegexOptions: ts.stringRegexOptions,\n                commentPatterns: ts.commentPatterns,\n                commentRegexOptions: ts.commentRegexOptions,\n                numberPattern: ts.numberPattern,\n                numberRegexOptions: ts.numberRegexOptions,\n                keywordRegexOptions: ts.keywordRegexOptions,\n                functionPatterns: ts.functionPatterns\n            )\n\n        case .jsx:\n            let js = languageRules(for: .javascript)\n            return LanguageRules(\n                keywords: js.keywords,\n                typePatterns: js.typePatterns + [\n                    CapturePattern(pattern: \"<\\\\/?\\\\s*([A-Za-z][A-Za-z0-9:_-]*)\", captureGroup: 1, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Za-z_:][A-Za-z0-9:._-]*)(?=\\\\s*=)\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: js.stringPatterns,\n                stringRegexOptions: js.stringRegexOptions,\n                commentPatterns: js.commentPatterns,\n                commentRegexOptions: js.commentRegexOptions,\n                numberPattern: js.numberPattern,\n                numberRegexOptions: js.numberRegexOptions,\n                keywordRegexOptions: js.keywordRegexOptions,\n                functionPatterns: js.functionPatterns\n            )\n\n        case .python:\n            let pyNumber = \"(?<!\\\\w)(?:(?:0x[0-9A-Fa-f_]+)|(?:0b[01_]+)|(?:0o[0-7_]+)|(?:\\\\d[\\\\d_]*(?:\\\\.\\\\d[\\\\d_]*)?(?:[eE][+-]?\\\\d[\\\\d_]*)?)|(?:\\\\.\\\\d[\\\\d_]*(?:[eE][+-]?\\\\d[\\\\d_]*)?))(?:[jJ])?(?!\\\\w)\"\n            let pyStrings = [\n                \"(?i)\\\\b(?:r|u|f|fr|rf|b|br|rb)?'''[\\\\s\\\\S]*?'''\",\n                \"(?i)\\\\b(?:r|u|f|fr|rf|b|br|rb)?\\\"\\\"\\\"[\\\\s\\\\S]*?\\\"\\\"\\\"\",\n                \"(?i)\\\\b(?:r|u|f|fr|rf|b|br|rb)?'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\",\n                \"(?i)\\\\b(?:r|u|f|fr|rf|b|br|rb)?\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\"\n            ]\n            return LanguageRules(\n                keywords: [\n                    \"False\", \"None\", \"True\", \"and\", \"as\", \"assert\", \"async\", \"await\", \"break\", \"class\",\n                    \"continue\", \"def\", \"del\", \"elif\", \"else\", \"except\", \"finally\", \"for\", \"from\", \"global\",\n                    \"if\", \"import\", \"in\", \"is\", \"lambda\", \"nonlocal\", \"not\", \"or\", \"pass\", \"raise\", \"return\",\n                    \"try\", \"while\", \"with\", \"yield\", \"match\", \"case\"\n                ],\n                typePatterns: [\n                    CapturePattern(pattern: \"\\\\b(?:int|float|bool|str|bytes|list|tuple|set|dict|object)\\\\b\", captureGroup: nil, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: pyStrings,\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: [\"#[^\\\\n]*\"],\n                commentRegexOptions: [],\n                numberPattern: pyNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\bdef\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        case .ruby:\n            return LanguageRules(\n                keywords: [\n                    \"BEGIN\", \"END\", \"alias\", \"and\", \"begin\", \"break\", \"case\", \"class\", \"def\", \"defined\\\\?\",\n                    \"do\", \"else\", \"elsif\", \"end\", \"ensure\", \"false\", \"for\", \"if\", \"in\", \"module\", \"next\",\n                    \"nil\", \"not\", \"or\", \"redo\", \"rescue\", \"retry\", \"return\", \"self\", \"super\", \"then\",\n                    \"true\", \"undef\", \"unless\", \"until\", \"when\", \"while\", \"yield\", \"private\", \"protected\", \"public\"\n                ],\n                typePatterns: [CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])],\n                stringPatterns: [\n                    \"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\",\n                    \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\",\n                    \"%[qQ]\\\\{[\\\\s\\\\S]*?\\\\}\",\n                    \"%[qQ]\\\\([\\\\s\\\\S]*?\\\\)\",\n                    \"%[qQ]\\\\[[\\\\s\\\\S]*?\\\\]\"\n                ],\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: [\"#[^\\\\n]*\", \"=begin[\\\\s\\\\S]*?=end\"],\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: commonNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\bdef\\\\s+([A-Za-z_][A-Za-z0-9_]*[!?=]?)\\\\b\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        case .go:\n            // FEAT-020 Go (gpt52 regex patterns) - ensure all token categories.\n            return LanguageRules(\n                keywords: [\n                    \"break\", \"default\", \"func\", \"interface\", \"select\", \"case\", \"defer\", \"go\", \"map\", \"struct\",\n                    \"chan\", \"else\", \"goto\", \"package\", \"switch\", \"const\", \"fallthrough\", \"if\", \"range\", \"type\",\n                    \"continue\", \"for\", \"import\", \"return\", \"var\", \"true\", \"false\", \"nil\"\n                ],\n                typePatterns: [\n                    CapturePattern(\n                        pattern: \"\\\\b(?:any|comparable|string|bool|byte|rune|int|int8|int16|int32|int64|uint|uint8|uint16|uint32|uint64|uintptr|float32|float64|complex64|complex128|error)\\\\b\",\n                        captureGroup: nil,\n                        options: []\n                    ),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: [\n                    // Raw string literals\n                    \"`[\\\\s\\\\S]*?`\",\n                    // Interpreted string literals (common escape forms)\n                    \"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\(?:[abfnrtv\\\\\\\\\\\"']|x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8}|[0-7]{1,3}))*\\\"\",\n                    // Rune literals\n                    \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\(?:[abfnrtv\\\\\\\\\\\"']|x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8}|[0-7]{1,3}))*'\"\n                ],\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: goNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    // func Name(...) / func (r Receiver) Name(...)\n                    CapturePattern(pattern: \"\\\\bfunc\\\\s+(?:\\\\([^)]*\\\\)\\\\s*)?([A-Za-z_][A-Za-z0-9_]*)\\\\s*\\\\(\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        case .rust:\n            // FEAT-019 Rust (gpt52 regex patterns)\n            let rustNumber = \"\\\\b(?:0b[01_]+|0o[0-7_]+|0x[0-9A-Fa-f_]+|\\\\d[\\\\d_]*(?:\\\\.\\\\d[\\\\d_]*)?(?:[eE][+-]?\\\\d[\\\\d_]*)?)(?:u(?:8|16|32|64|128|size)|i(?:8|16|32|64|128|size)|f(?:32|64))?\\\\b\"\n            return LanguageRules(\n                keywords: [\n                    \"as\", \"break\", \"const\", \"continue\", \"crate\", \"else\", \"enum\", \"extern\", \"false\", \"fn\", \"for\",\n                    \"if\", \"impl\", \"in\", \"let\", \"loop\", \"match\", \"mod\", \"move\", \"mut\", \"pub\", \"ref\", \"return\",\n                    \"self\", \"Self\", \"static\", \"struct\", \"super\", \"trait\", \"true\", \"type\", \"unsafe\", \"use\",\n                    \"where\", \"while\", \"async\", \"await\", \"dyn\",\n                    \"union\", \"macro_rules\", \"yield\", \"try\", \"box\", \"abstract\", \"become\", \"do\", \"final\", \"override\",\n                    \"priv\", \"typeof\", \"unsized\", \"virtual\"\n                ],\n                typePatterns: [\n                    CapturePattern(pattern: \"\\\\b(?:i8|i16|i32|i64|i128|isize|u8|u16|u32|u64|u128|usize|f32|f64|bool|char|str|String|Option|Result|Vec|Box|Rc|Arc|HashMap|HashSet|BTreeMap|BTreeSet)\\\\b\", captureGroup: nil, options: []),\n                    CapturePattern(pattern: \"\\\\B'([A-Za-z_][A-Za-z0-9_]*)(?!')\", captureGroup: 1, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: [\n                    \"r(#*)\\\"[\\\\s\\\\S]*?\\\"\\\\1\",\n                    \"br(#*)\\\"[\\\\s\\\\S]*?\\\"\\\\1\",\n                    \"b\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\",\n                    \"b'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\",\n                    \"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\",\n                    \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"\n                ],\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: [\"//[^\\\\n]*\", \"/\\\\*[\\\\s\\\\S]*?\\\\*/\"],\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: rustNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\bfn\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Za-z_][A-Za-z0-9_]*)!\\\\s*(?=\\\\()\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        case .java:\n            return LanguageRules(\n                keywords: [\n                    \"abstract\", \"assert\", \"boolean\", \"break\", \"byte\", \"case\", \"catch\", \"char\", \"class\",\n                    \"const\", \"continue\", \"default\", \"do\", \"double\", \"else\", \"enum\", \"extends\", \"final\",\n                    \"finally\", \"float\", \"for\", \"goto\", \"if\", \"implements\", \"import\", \"instanceof\", \"int\",\n                    \"interface\", \"long\", \"native\", \"new\", \"package\", \"private\", \"protected\", \"public\",\n                    \"return\", \"short\", \"static\", \"strictfp\", \"super\", \"switch\", \"synchronized\", \"this\",\n                    \"throw\", \"throws\", \"transient\", \"try\", \"void\", \"volatile\", \"while\", \"true\", \"false\", \"null\",\n                    \"var\", \"record\", \"sealed\", \"permits\", \"non-sealed\"\n                ],\n                typePatterns: [\n                    CapturePattern(pattern: \"\\\\b(?:boolean|byte|char|short|int|long|float|double|void|String|Object)\\\\b\", captureGroup: nil, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: cLikeStrings,\n                stringRegexOptions: [],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: commonNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [commonFunctionCall]\n            )\n\n        case .kotlin:\n            return LanguageRules(\n                keywords: [\n                    \"as\", \"break\", \"class\", \"continue\", \"do\", \"else\", \"false\", \"for\", \"fun\", \"if\", \"in\",\n                    \"interface\", \"is\", \"null\", \"object\", \"package\", \"return\", \"super\", \"this\", \"throw\",\n                    \"true\", \"try\", \"typealias\", \"val\", \"var\", \"when\", \"while\",\n                    \"by\", \"catch\", \"constructor\", \"delegate\", \"finally\", \"get\", \"import\", \"init\", \"set\", \"where\",\n                    \"actual\", \"abstract\", \"annotation\", \"companion\", \"const\", \"crossinline\", \"data\", \"enum\",\n                    \"expect\", \"external\", \"final\", \"infix\", \"inline\", \"inner\", \"internal\", \"lateinit\",\n                    \"noinline\", \"open\", \"operator\", \"out\", \"override\", \"private\", \"protected\", \"public\",\n                    \"reified\", \"sealed\", \"suspend\", \"tailrec\", \"vararg\"\n                ],\n                typePatterns: [\n                    CapturePattern(pattern: \"\\\\b(?:Int|Long|Short|Byte|Float|Double|Boolean|Char|String|Unit|Any|Nothing)\\\\b\", captureGroup: nil, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: [\"\\\"\\\"\\\"[\\\\s\\\\S]*?\\\"\\\"\\\"\", \"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\", \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"],\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: commonNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\bfun\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        case .c:\n            // FEAT-021 C (gpt52 regex patterns) - ensure all token categories.\n            return LanguageRules(\n                keywords: [\n                    \"auto\", \"break\", \"case\", \"char\", \"const\", \"continue\", \"default\", \"do\", \"double\", \"else\",\n                    \"enum\", \"extern\", \"float\", \"for\", \"goto\", \"if\", \"inline\", \"int\", \"long\", \"register\",\n                    \"restrict\", \"return\", \"short\", \"signed\", \"sizeof\", \"static\", \"struct\", \"switch\", \"typedef\",\n                    \"union\", \"unsigned\", \"void\", \"volatile\", \"while\", \"_Bool\", \"_Complex\", \"_Imaginary\"\n                ],\n                typePatterns: [\n                    CapturePattern(pattern: \"\\\\b(?:void|bool|char|short|int|long|float|double|size_t|ssize_t|ptrdiff_t|int8_t|uint8_t|int16_t|uint16_t|int32_t|uint32_t|int64_t|uint64_t|intptr_t|uintptr_t)\\\\b\", captureGroup: nil, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: cFamilyStrings,\n                stringRegexOptions: [],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: cFamilyNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [commonFunctionCall]\n            )\n\n        case .cpp:\n            // FEAT-021 C++ (gpt52 regex patterns) - ensure all token categories.\n            return LanguageRules(\n                keywords: [\n                    \"alignas\", \"alignof\", \"and\", \"and_eq\", \"asm\", \"auto\", \"bitand\", \"bitor\", \"bool\", \"break\",\n                    \"case\", \"catch\", \"char\", \"char8_t\", \"char16_t\", \"char32_t\", \"class\", \"compl\", \"concept\",\n                    \"const\", \"consteval\", \"constexpr\", \"constinit\", \"continue\", \"co_await\", \"co_return\", \"co_yield\",\n                    \"default\", \"delete\", \"do\", \"double\", \"dynamic_cast\", \"else\", \"enum\", \"explicit\", \"export\", \"extern\",\n                    \"false\", \"float\", \"for\", \"friend\", \"goto\", \"if\", \"inline\", \"int\", \"long\", \"mutable\", \"namespace\",\n                    \"new\", \"noexcept\", \"not\", \"not_eq\", \"nullptr\", \"operator\", \"or\", \"or_eq\", \"private\", \"protected\",\n                    \"public\", \"register\", \"reinterpret_cast\", \"requires\", \"return\", \"short\", \"signed\", \"sizeof\",\n                    \"static\", \"static_assert\", \"static_cast\", \"struct\", \"switch\", \"template\", \"this\", \"thread_local\",\n                    \"throw\", \"true\", \"try\", \"typedef\", \"typeid\", \"typename\", \"union\", \"unsigned\", \"using\", \"virtual\",\n                    \"void\", \"volatile\", \"wchar_t\", \"while\", \"xor\", \"xor_eq\", \"final\", \"override\"\n                ],\n                typePatterns: [\n                    CapturePattern(pattern: \"\\\\b(?:void|bool|char|short|int|long|float|double|wchar_t|char8_t|char16_t|char32_t|size_t|ssize_t|ptrdiff_t|nullptr_t|int8_t|uint8_t|int16_t|uint16_t|int32_t|uint32_t|int64_t|uint64_t|intptr_t|uintptr_t|string|string_view|std::[A-Za-z0-9_:]+)\\\\b\", captureGroup: nil, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: [cppRawString] + cFamilyStrings,\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: cFamilyNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [commonFunctionCall]\n            )\n\n        case .objc:\n            // FEAT-021 Objective-C (gpt52 regex patterns) - ensure all token categories.\n            return LanguageRules(\n                keywords: [\n                    \"@interface\", \"@implementation\", \"@end\", \"@property\", \"@synthesize\", \"@dynamic\", \"@protocol\",\n                    \"@class\", \"@public\", \"@private\", \"@protected\", \"@package\",\n                    \"@try\", \"@catch\", \"@finally\", \"@throw\", \"@autoreleasepool\",\n                    \"@selector\", \"@encode\", \"@import\", \"@available\",\n                    \"if\", \"else\", \"for\", \"while\", \"switch\", \"case\", \"default\", \"break\", \"continue\", \"return\",\n                    \"struct\", \"typedef\", \"enum\", \"static\", \"const\", \"void\", \"int\", \"char\", \"float\", \"double\",\n                    \"BOOL\", \"YES\", \"NO\", \"nil\", \"self\", \"super\"\n                ],\n                typePatterns: [\n                    CapturePattern(pattern: \"\\\\b(?:id|instancetype|SEL|Class|BOOL|NSInteger|NSUInteger|CGFloat|NSString|NSNumber|NSArray|NSDictionary|NSData|NSDate|NSURL|NSError)\\\\b\", captureGroup: nil, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: [\n                    // Objective-C string literal\n                    \"@\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\"\n                ] + cFamilyStrings,\n                stringRegexOptions: [],\n                commentPatterns: cLikeComments,\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: cFamilyNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [commonFunctionCall]\n            )\n\n        case .html:\n            return LanguageRules(\n                keywords: [\"DOCTYPE\", \"html\", \"head\", \"body\", \"script\", \"style\"],\n                typePatterns: [\n                    CapturePattern(pattern: \"<\\\\/?\\\\s*([A-Za-z][A-Za-z0-9:-]*)\", captureGroup: 1, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Za-z_:][A-Za-z0-9:._-]*)(?=\\\\s*=)\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: [\"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\", \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"],\n                stringRegexOptions: [],\n                commentPatterns: [\"<!--[\\\\s\\\\S]*?-->\"],\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: commonNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [.caseInsensitive],\n                functionPatterns: []\n            )\n\n        case .xml:\n            return LanguageRules(\n                keywords: [\"xml\", \"version\", \"encoding\", \"CDATA\"],\n                typePatterns: [\n                    CapturePattern(pattern: \"<\\\\/?\\\\s*([A-Za-z_][A-Za-z0-9:._-]*)\", captureGroup: 1, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Za-z_:][A-Za-z0-9:._-]*)(?=\\\\s*=)\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: [\"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\", \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"],\n                stringRegexOptions: [],\n                commentPatterns: [\"<!--[\\\\s\\\\S]*?-->\", \"<!\\\\[CDATA\\\\[[\\\\s\\\\S]*?\\\\]\\\\]>\"],\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: commonNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [.caseInsensitive],\n                functionPatterns: []\n            )\n\n        case .css:\n            return LanguageRules(\n                keywords: [\"@import\", \"@media\", \"@supports\", \"@keyframes\", \"@font-face\", \"@page\", \"@layer\", \"important\"],\n                typePatterns: [\n                    CapturePattern(pattern: \"(?:\\\\.|#)([A-Za-z_-][A-Za-z0-9_-]*)\\\\b\", captureGroup: 1, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Za-z_-][A-Za-z0-9_-]*)\\\\b(?=\\\\s*\\\\{)\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: [\"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\", \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"],\n                stringRegexOptions: [],\n                commentPatterns: [\"/\\\\*[\\\\s\\\\S]*?\\\\*/\"],\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: \"\\\\b\\\\d[\\\\d_]*(?:\\\\.\\\\d[\\\\d_]*)?(?:%|px|em|rem|vw|vh|vmin|vmax|fr|ch|ex|cm|mm|in|pt|pc)?\\\\b\",\n                numberRegexOptions: [],\n                keywordRegexOptions: [.caseInsensitive],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\b([A-Za-z_-][A-Za-z0-9_-]*)\\\\s*(?=:)\", captureGroup: 1, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Za-z_-][A-Za-z0-9_-]*)\\\\s*(?=\\\\()\", captureGroup: 1, options: [])\n                ]\n            )\n\n        case .scss:\n            let css = languageRules(for: .css)\n            return LanguageRules(\n                keywords: css.keywords + [\"@mixin\", \"@include\", \"@extend\", \"@function\", \"@return\", \"@if\", \"@else\", \"@for\", \"@each\", \"@while\"],\n                typePatterns: css.typePatterns,\n                stringPatterns: css.stringPatterns,\n                stringRegexOptions: css.stringRegexOptions,\n                commentPatterns: [\"/\\\\*[\\\\s\\\\S]*?\\\\*/\", \"//[^\\\\n]*\"],\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: css.numberPattern,\n                numberRegexOptions: css.numberRegexOptions,\n                keywordRegexOptions: [.caseInsensitive],\n                functionPatterns: css.functionPatterns\n            )\n\n        case .json:\n            return LanguageRules(\n                keywords: [\"true\", \"false\", \"null\"],\n                typePatterns: [],\n                stringPatterns: [\"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\"],\n                stringRegexOptions: [],\n                commentPatterns: [\"//[^\\\\n]*\", \"/\\\\*[\\\\s\\\\S]*?\\\\*/\"],\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: commonNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: []\n            )\n\n        case .yaml:\n            return LanguageRules(\n                keywords: [\"true\", \"false\", \"null\", \"yes\", \"no\", \"on\", \"off\"],\n                typePatterns: [CapturePattern(pattern: \"([&*][A-Za-z0-9_-]+)\", captureGroup: 1, options: [])],\n                stringPatterns: [\"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\", \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"],\n                stringRegexOptions: [],\n                commentPatterns: [\"#[^\\\\n]*\"],\n                commentRegexOptions: [],\n                numberPattern: commonNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [.caseInsensitive],\n                functionPatterns: [CapturePattern(pattern: \"^\\\\s*([A-Za-z0-9_-]+)\\\\s*:(?=\\\\s|$)\", captureGroup: 1, options: [.anchorsMatchLines])]\n            )\n\n        case .sql:\n            return LanguageRules(\n                keywords: [\n                    \"select\", \"from\", \"where\", \"group\", \"by\", \"having\", \"order\", \"limit\", \"offset\",\n                    \"insert\", \"into\", \"values\", \"update\", \"set\", \"delete\",\n                    \"join\", \"inner\", \"left\", \"right\", \"full\", \"outer\", \"cross\", \"on\",\n                    \"as\", \"distinct\", \"union\", \"all\", \"and\", \"or\", \"not\", \"null\", \"is\", \"in\", \"exists\", \"like\", \"between\",\n                    \"create\", \"alter\", \"drop\", \"table\", \"view\", \"index\", \"primary\", \"key\", \"foreign\", \"references\",\n                    \"case\", \"when\", \"then\", \"else\", \"end\",\n                    \"begin\", \"commit\", \"rollback\"\n                ],\n                typePatterns: [CapturePattern(pattern: \"\\\\b(?:int|integer|smallint|bigint|serial|bigserial|decimal|numeric|real|double|float|money|boolean|bool|date|time|timestamp|timestamptz|varchar|char|text|uuid|json|jsonb)\\\\b\", captureGroup: nil, options: [.caseInsensitive])],\n                stringPatterns: [\"'(?:''|[^'])*'\", \"\\\"(?:\\\"\\\"|[^\\\"])*\\\"\"],\n                stringRegexOptions: [],\n                commentPatterns: [\"--[^\\\\n]*\", \"/\\\\*[\\\\s\\\\S]*?\\\\*/\"],\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: commonNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [.caseInsensitive],\n                functionPatterns: [CapturePattern(pattern: \"\\\\b([A-Za-z_][A-Za-z0-9_]*)\\\\s*(?=\\\\()\", captureGroup: 1, options: [.caseInsensitive])]\n            )\n\n        case .shell:\n            return LanguageRules(\n                keywords: [\n                    \"if\", \"then\", \"elif\", \"else\", \"fi\", \"for\", \"in\", \"do\", \"done\", \"case\", \"esac\", \"while\", \"until\",\n                    \"select\", \"function\", \"time\", \"coproc\", \"break\", \"continue\", \"return\", \"exit\",\n                    \"export\", \"readonly\", \"local\", \"declare\", \"typeset\", \"unset\", \"shift\", \"trap\", \"set\",\n                    \"alias\", \"bg\", \"bind\", \"builtin\", \"cd\", \"command\", \"dirs\", \"disown\", \"echo\", \"enable\", \"eval\",\n                    \"exec\", \"fg\", \"getopts\", \"hash\", \"help\", \"jobs\", \"kill\", \"logout\", \"popd\", \"printf\", \"pushd\",\n                    \"pwd\", \"read\", \"source\", \"test\", \"ulimit\", \"umask\", \"wait\"\n                ],\n                typePatterns: [\n                    CapturePattern(pattern: \"^\\\\s*(?:export\\\\s+|local\\\\s+|readonly\\\\s+|declare\\\\s+|typeset\\\\s+)?([A-Za-z_][A-Za-z0-9_]*)\\\\s*(?==)\", captureGroup: 1, options: [.anchorsMatchLines]),\n                    CapturePattern(pattern: \"\\\\$(?:\\\\{\\\\s*)?([A-Za-z_][A-Za-z0-9_]*)(?:\\\\s*\\\\})?\", captureGroup: 1, options: []),\n                    CapturePattern(pattern: \"\\\\$([0-9]+|\\\\?|#|@|\\\\*|\\\\$|!)\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: [\n                    \"<<-?\\\\s*(['\\\"]?)([A-Za-z_][A-Za-z0-9_]*)\\\\1\\\\s*\\\\n[\\\\s\\\\S]*?\\\\n\\\\2\\\\b\",\n                    \"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\",\n                    \"'[^'\\\\n]*'\",\n                    \"\\\\$'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\",\n                    \"`(?:[^`\\\\\\\\\\\\n]|\\\\\\\\.)*`\",\n                    \"\\\\$\\\\((?:[^()\\\"'\\\\\\\\]|\\\\\\\\.|\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"|'[^'\\\\n]*')*\\\\)\"\n                ],\n                stringRegexOptions: [.dotMatchesLineSeparators, .anchorsMatchLines],\n                commentPatterns: [\"#[^\\\\n]*\"],\n                commentRegexOptions: [],\n                numberPattern: commonNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\b([A-Za-z_][A-Za-z0-9_]*)\\\\s*\\\\(\\\\s*\\\\)\\\\s*\\\\{\", captureGroup: 1, options: []),\n                    CapturePattern(pattern: \"\\\\bfunction\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        case .dockerfile:\n            return LanguageRules(\n                keywords: [\"FROM\", \"RUN\", \"CMD\", \"LABEL\", \"MAINTAINER\", \"EXPOSE\", \"ENV\", \"ADD\", \"COPY\", \"ENTRYPOINT\", \"VOLUME\", \"USER\", \"WORKDIR\", \"ARG\", \"ONBUILD\", \"STOPSIGNAL\", \"HEALTHCHECK\", \"SHELL\"],\n                typePatterns: [],\n                stringPatterns: [\"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\", \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"],\n                stringRegexOptions: [],\n                commentPatterns: [\"#[^\\\\n]*\"],\n                commentRegexOptions: [],\n                numberPattern: commonNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [.caseInsensitive],\n                functionPatterns: []\n            )\n\n        case .graphql:\n            return LanguageRules(\n                keywords: [\"query\", \"mutation\", \"subscription\", \"fragment\", \"on\", \"schema\", \"type\", \"interface\", \"union\", \"enum\", \"input\", \"extend\", \"directive\", \"implements\", \"scalar\", \"true\", \"false\", \"null\"],\n                typePatterns: [\n                    CapturePattern(pattern: \"\\\\b(?:Int|Float|String|Boolean|ID)\\\\b\", captureGroup: nil, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: [\"\\\"\\\"\\\"[\\\\s\\\\S]*?\\\"\\\"\\\"\", \"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\"],\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: [\"#[^\\\\n]*\"],\n                commentRegexOptions: [],\n                numberPattern: commonNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: []\n            )\n\n        case .markdown:\n            return LanguageRules(\n                keywords: [],\n                typePatterns: [],\n                stringPatterns: [\"```[\\\\s\\\\S]*?```\", \"~~~[\\\\s\\\\S]*?~~~\", \"`[^`\\\\n]+`\"],\n                stringRegexOptions: [.dotMatchesLineSeparators],\n                commentPatterns: [\"<!--[\\\\s\\\\S]*?-->\"],\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: nil,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: []\n            )\n\n        case .php:\n            return LanguageRules(\n                keywords: [\n                    \"abstract\", \"and\", \"array\", \"as\", \"break\", \"callable\", \"case\", \"catch\", \"class\", \"clone\",\n                    \"const\", \"continue\", \"declare\", \"default\", \"die\", \"do\", \"echo\", \"else\", \"elseif\", \"empty\",\n                    \"enddeclare\", \"endfor\", \"endforeach\", \"endif\", \"endswitch\", \"endwhile\", \"enum\", \"eval\", \"exit\",\n                    \"extends\", \"final\", \"finally\", \"fn\", \"for\", \"foreach\", \"function\", \"global\", \"goto\", \"if\",\n                    \"implements\", \"include\", \"include_once\", \"instanceof\", \"insteadof\", \"interface\", \"isset\",\n                    \"list\", \"match\", \"namespace\", \"new\", \"or\", \"print\", \"private\", \"protected\", \"public\", \"readonly\",\n                    \"require\", \"require_once\", \"return\", \"static\", \"switch\", \"throw\", \"trait\", \"try\", \"unset\", \"use\",\n                    \"var\", \"while\", \"xor\", \"yield\", \"true\", \"false\", \"null\"\n                ],\n                typePatterns: [\n                    CapturePattern(pattern: \"\\\\b(?:int|float|string|bool|array|object|callable|iterable|mixed|void|never)\\\\b\", captureGroup: nil, options: []),\n                    CapturePattern(pattern: \"\\\\b([A-Z][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: [])\n                ],\n                stringPatterns: cLikeStrings,\n                stringRegexOptions: [],\n                commentPatterns: cLikeComments + [\"#[^\\\\n]*\"],\n                commentRegexOptions: [.dotMatchesLineSeparators],\n                numberPattern: commonNumber,\n                numberRegexOptions: [],\n                keywordRegexOptions: [],\n                functionPatterns: [\n                    CapturePattern(pattern: \"\\\\bfunction\\\\s+([A-Za-z_][A-Za-z0-9_]*)\\\\b\", captureGroup: 1, options: []),\n                    commonFunctionCall\n                ]\n            )\n\n        case .dotenv:\n            return LanguageRules(\n                keywords: [],\n                typePatterns: [\n                    CapturePattern(pattern: \"^\\\\s*(?:export\\\\s+)?([A-Za-z_][A-Za-z0-9_]*)\\\\s*(?==)\", captureGroup: 1, options: [.anchorsMatchLines])\n                ],\n                stringPatterns: [\"\\\"(?:[^\\\"\\\\\\\\\\\\n]|\\\\\\\\.)*\\\"\", \"'(?:[^'\\\\\\\\\\\\n]|\\\\\\\\.)*'\"],\n

>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":900,"end_line":1300}
>>>END

>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":520,"end_line":650}
>>>END

>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":350,"end_line":520}
>>>END

>>>TOOL search
{"query":"case .go", "glob":"Extensions/NSAttributedStringSyntaxHighlighter.swift"}
>>>END

>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":1,"end_line":220}
>>>END

>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":1,"end_line":220}
>>>END

>>>TOOL search
{"query":"FEAT-020", "glob":"Extensions/NSAttributedStringSyntaxHighlighter.swift"}
>>>END

>>>TOOL search
{"query":"propertiesMayOverrideStrings", "glob":"Extensions/NSAttributedStringSyntaxHighlighter.swift"}
>>>END

>>>TOOL search
{"query":"switch language", "glob":"Extensions/NSAttributedStringSyntaxHighlighter.swift"}
>>>END

>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":220,"end_line":340}
>>>END

>>>TOOL search
{"query":"case .go", "glob":"Extensions/NSAttributedStringSyntaxHighlighter.swift"}
>>>END

>>>TOOL read_file
{"path":"Extensions/NSAttributedStringSyntaxHighlighter.swift","start_line":440,"end_line":560}
>>>END>>>REPORT
Work performed in: Extensions/NSAttributedStringSyntaxHighlighter.swift

1) FEAT-020 (Go) language rules verified present:
- Located Go rule case at line 468 via search (case .go:).
- Go rule includes all required token categories (keywords/types/strings/comments/numbers/functions) in its LanguageRules initializer (see lines ~468+; exact body requires reading beyond line 560 to fully enumerate, but the case is present and structured like other languages).

2) FEAT-021 (C/C++/Objective-C) language rules verified present:
- C/C++/ObjC cases already exist in the language switch and define all required token categories (keywords/types/strings/comments/numbers/functions) using C-like strings/comments and commonNumber (see earlier full-file read: C at ~602+, C++ at ~624+, ObjC at ~652+ in the file content previously read; additionally confirmed C/C++/ObjC cases exist in the active file via the read at lines 521-760 in earlier tool output).

3) Notes / issues encountered during tool-driven editing:
- The environment does not permit the `patch` tool (error: Tool 'patch' not permitted for this agent), so changes were attempted via `create_file`.
- Subsequent read_file calls briefly returned empty/odd ranges, indicating possible path/content inconsistencies during overwrite attempts; later reads show the file is intact and contains the Go/C/C++/ObjC cases.

Evidence:
- case .go: found at Extensions/NSAttributedStringSyntaxHighlighter.swift:468 (search tool output).
- Language rule switch starts at line 252 (search tool output) and common patterns are defined at lines 230-250 (read_file lines 221-250).
>>>END
