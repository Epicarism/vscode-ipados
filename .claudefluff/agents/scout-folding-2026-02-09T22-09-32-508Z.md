# Agent: scout-folding
**Status:** done
**Tokens:** 2,124
**Cost:** $0.0000
**Time:** 2026-02-09T22:09:32.508Z

## Task
Read CodeFoldingManager.swift and find the fold/unfold methods. Check if they're stubs. Report what's needed to make them work.

## Response
I'll read the CodeFoldingManager.swift file to find the fold/unfold methods and analyze them.

>>>TOOL read_file
{"path": "CodeFoldingManager.swift"}
>>>END

I found the fold/unfold methods in the file. Let me analyze them:

## Analysis of Fold/Unfold Methods

### Stub Methods Found (Lines 571-580)

**1. `foldCurrentLine()` at lines 571-574:**
```swift
/// Folds the region at current cursor line (stub - requires cursor position from editor)
func foldCurrentLine() {
    // This would need cursor position from the editor
    // For now, it's a no-op since we don't have cursor context
}
```

**2. `unfoldCurrentLine()` at lines 576-580:**
```swift
/// Unfolds the region at current cursor line (stub - requires cursor position from editor)
func unfoldCurrentLine() {
    // This would need cursor position from the editor
    // For now, it's a no-op since we don't have cursor context
}
```

These are **confirmed stubs** - they have empty implementations with comments explicitly stating they're no-ops.

### Fully Implemented Methods

The following fold/unfold methods ARE fully implemented and functional:
- `toggleFold(at line: Int)` - Lines 522-532
- `expandRegion(at line: Int)` - Lines 535-544  
- `collapseRegion(at line: Int)` - Lines 547-556
- `expandAll()` - Lines 559-568
- `collapseAll()` - Lines 583-592
- `collapseAll(ofType:)` - Lines 595-606
- `expandAll(ofType:)` - Lines 609-620

## What's Needed to Make the Stubs Work

To make `foldCurrentLine()` and `unfoldCurrentLine()` functional, you need to:

1. **Add a cursor position tracking mechanism** - The manager needs to know which line the cursor is currently on

2. **Modify the methods to accept cursor position** - Either:
   - Add a `currentLine` parameter to these methods, OR
   - Add a `@Published var currentCursorLine: Int` property to track cursor position

3. **Implement the actual fold/unfold logic** - The methods should call the existing `collapseRegion(at:)` or `expandRegion(at:)` methods

### Example Implementation

```swift
// Option 1: Add parameter
func foldCurrentLine(at line: Int) {
    if let region = foldRegions.first(where: { $0.startLine == line }) {
        collapseRegion(at: line)
    } else {
        // Check if cursor is within a region
        if let region = foldRegions.first(where: { line >= $0.startLine && line <= $0.endLine }) {
            collapseRegion(at: region.startLine)
        }
    }
}

func unfoldCurrentLine(at line: Int) {
    if let region = foldRegions.first(where: { $0.startLine == line }) {
        expandRegion(at: line)
    } else {
        // Check if cursor is within a region
        if let region = foldRegions.first(where: { line >= $0.startLine && line <= $0.endLine }) {
            expandRegion(at: region.startLine)
        }
    }
}
```

The implementation infrastructure already exists - you just need to connect the cursor position to these methods.

>>>REPORT
## CodeFoldingManager.swift - Fold/Unfold Methods Analysis

### âœ… STUB METHODS IDENTIFIED

**File:** VSCodeiPadOS/VSCodeiPadOS/Services/CodeFoldingManager.swift

**Stub Method 1 - `foldCurrentLine()` (Lines 571-574):**
```swift
/// Folds the region at current cursor line (stub - requires cursor position from editor)
func foldCurrentLine() {
    // This would need cursor position from the editor
    // For now, it's a no-op since we don't have cursor context
}
```

**Stub Method 2 - `unfoldCurrentLine()` (Lines 576-580):**
```swift
/// Unfolds the region at current cursor line (stub - requires cursor position from editor)
func unfoldCurrentLine() {
    // This would need cursor position from the editor
    // For now, it's a no-op since we don't have cursor context
}
```

### âœ… FULLY IMPLEMENTED METHODS (Working)

The following fold/unfold methods are **fully functional** (Lines 522-620):
- `toggleFold(at line: Int)` - Toggles fold state at specific line
- `expandRegion(at line: Int)` - Expands a folded region
- `collapseRegion(at line: Int)` - Collapses a region
- `expandAll()` - Expands all folded regions
- `collapseAll()` - Collapses all regions
- `collapseAll(ofType type:)` - Collapses regions by type
- `expandAll(ofType type:)` - Expands regions by type

### ðŸ”§ WHAT'S NEEDED TO MAKE STUBS WORK

**1. Add Cursor Position Tracking:**
   - Either add a `currentCursorLine: Int` parameter to the methods
   - OR add a `@Published var currentCursorLine: Int` property to track cursor state

**2. Implement Region Lookup Logic:**
   - Find fold region that contains the cursor line (not just starts at it)
   - Call existing `collapseRegion(at:)` or `expandRegion(at:)` methods

**3. Integrate with Editor:**
   - Editor component needs to provide cursor position updates to CodeFoldingManager
   - This requires bi-directional communication between editor and folding manager

**Suggested Implementation:**
```swift
func foldCurrentLine(at cursorLine: Int) {
    // Find region containing cursor line
    if let region = foldRegions.first(where: { 
        cursorLine >= $0.startLine && cursorLine <= $0.endLine 
    }) {
        collapseRegion(at: region.startLine)
    }
}

func unfoldCurrentLine(at cursorLine: Int) {
    // Find region containing cursor line
    if let region = foldRegions.first(where: { 
        cursorLine >= $0.startLine && cursorLine <= $0.endLine 
    }) {
        expandRegion(at: region.startLine)
    }
}
```

The core folding infrastructure exists - only cursor position integration is missing.
>>>END
