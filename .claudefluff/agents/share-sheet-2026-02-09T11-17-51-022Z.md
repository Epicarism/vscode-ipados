# Agent: share-sheet
**Status:** done
**Tokens:** 2,187
**Cost:** $0.0000
**Time:** 2026-02-09T11:17:51.022Z

## Task
Add a context menu to IDETabItem in ContentView.swift with a 'Share' button that presents a UIActivityViewController for the file URL.

## Response
I'll help you add a context menu to IDETabItem with a Share button. Let me first examine the current ContentView.swift file.

>>>TOOL read_file
{"path": "VSCodeiPadOS/VSCodeiPadOS/Views/ContentView.swift"}
>>>END

I'll add a context menu to the IDETabItem with a Share button that presents a UIActivityViewController. Let me examine the structure more closely and then apply the changes.

>>>FILE VSCodeiPadOS/VSCodeiPadOS/Views/ContentView.swift
>>>FIND
struct IDETabItem: View {
    let tab: Tab
    let isSelected: Bool
    @ObservedObject var editorCore: EditorCore
    let theme: Theme
    
    var body: some View {
        HStack(spacing: 6) {
            Image(systemName: fileIcon(for: tab.fileName)).font(.caption).foregroundColor(fileColor(for: tab.fileName))
            Text(tab.fileName).font(.system(size: 12)).lineLimit(1)
                .foregroundColor(isSelected ? theme.tabActiveForeground : theme.tabInactiveForeground)
            if tab.isUnsaved { Circle().fill(Color.orange).frame(width: 6, height: 6) }
            Button(action: { editorCore.closeTab(id: tab.id) }) {
                Image(systemName: "xmark").font(.system(size: 9, weight: .medium))
                    .foregroundColor(isSelected ? theme.tabActiveForeground.opacity(0.6) : theme.tabInactiveForeground)
            }
        }
        .padding(.horizontal, 12).padding(.vertical, 6)
        .background(RoundedRectangle(cornerRadius: 4).fill(isSelected ? theme.tabActiveBackground : theme.tabInactiveBackground))
        .onTapGesture { editorCore.selectTab(id: tab.id) }
    }
}
>>>REPLACE
struct IDETabItem: View {
    let tab: Tab
    let isSelected: Bool
    @ObservedObject var editorCore: EditorCore
    let theme: Theme
    @State private var showingShareSheet = false
    
    var body: some View {
        HStack(spacing: 6) {
            Image(systemName: fileIcon(for: tab.fileName)).font(.caption).foregroundColor(fileColor(for: tab.fileName))
            Text(tab.fileName).font(.system(size: 12)).lineLimit(1)
                .foregroundColor(isSelected ? theme.tabActiveForeground : theme.tabInactiveForeground)
            if tab.isUnsaved { Circle().fill(Color.orange).frame(width: 6, height: 6) }
            Button(action: { editorCore.closeTab(id: tab.id) }) {
                Image(systemName: "xmark").font(.system(size: 9, weight: .medium))
                    .foregroundColor(isSelected ? theme.tabActiveForeground.opacity(0.6) : theme.tabInactiveForeground)
            }
        }
        .padding(.horizontal, 12).padding(.vertical, 6)
        .background(RoundedRectangle(cornerRadius: 4).fill(isSelected ? theme.tabActiveBackground : theme.tabInactiveBackground))
        .onTapGesture { editorCore.selectTab(id: tab.id) }
        .contextMenu {
            if let fileURL = tab.url {
                Button(action: { showingShareSheet = true }) {
                    Label("Share", systemImage: "square.and.arrow.up")
                }
            }
        }
        .sheet(isPresented: $showingShareSheet) {
            if let fileURL = tab.url {
                ShareSheet(activityItems: [fileURL])
            }
        }
    }
}
>>>END

Now I need to add the ShareSheet UIViewControllerRepresentable. Let me add it after the IDEDocumentPicker:

>>>FILE VSCodeiPadOS/VSCodeiPadOS/Views/ContentView.swift
>>>FIND
// MARK: - Sidebar Search View

struct SidebarSearchView: View {
>>>REPLACE
// MARK: - Share Sheet

struct ShareSheet: UIViewControllerRepresentable {
    let activityItems: [Any]
    
    func makeUIViewController(context: Context) -> UIActivityViewController {
        let controller = UIActivityViewController(activityItems: activityItems, applicationActivities: nil)
        return controller
    }
    
    func updateUIViewController(_ uiViewController: UIActivityViewController, context: Context) {}
}

// MARK: - Sidebar Search View

struct SidebarSearchView: View {
>>>END

>>>REPORT
I've successfully added a context menu to IDETabItem in ContentView.swift with a Share button that presents a UIActivityViewController for the file URL.

**Changes made:**

1. **IDETabItem struct (lines 350-371):**
   - Added `@State private var showingShareSheet = false` to manage the share sheet presentation
   - Added `.contextMenu` modifier with a "Share" button (only shown if the tab has a file URL)
   - Added `.sheet` modifier to present the ShareSheet when triggered

2. **ShareSheet UIViewControllerRepresentable (added after line 843):**
   - Created a new `ShareSheet` struct that wraps `UIActivityViewController`
   - Takes `activityItems` (array of items to share) as a parameter
   - Properly conforms to UIViewControllerRepresentable protocol

**How it works:**
- Right-click or long-press on any tab that has an associated file URL
- A context menu appears with a "Share" option
- Clicking "Share" presents the native iOS share sheet with the file URL
- Users can share the file via AirDrop, Messages, Mail, or other sharing options

The implementation only shows the Share option for tabs that have a valid file URL (the `tab.url` property is not nil), preventing errors for unsaved or demo files.
>>>END
