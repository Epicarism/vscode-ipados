import SwiftUI

/// Go menu commands for VSCode iPadOS
/// Provides navigation options for files, symbols, definitions, and editor navigation
struct GoMenuCommands: Commands {
    // MARK: - Dependencies
    
    @FocusedValue(\.menuEditorCore) private var editorCore: EditorCore?
    
    // MARK: - Body
    
    var body: some Commands {
        CommandMenu("Go") {
            // MARK: - File & Symbol Navigation
            
            Button("Go to File") {
                editorCore?.toggleQuickOpen()
            }
            .keyboardShortcut("p", modifiers: [.command])
            
            Button("Go to Symbol in Workspace") {
                editorCore?.toggleGoToSymbol()
            }
            .keyboardShortcut("t", modifiers: [.command])
            
            Button("Go to Symbol in Editor") {
                editorCore?.toggleGoToSymbol()
            }
            .keyboardShortcut("o", modifiers: [.command, .shift])
            
            Divider()
            
            // MARK: - Definition Navigation
            
            Button("Go to Definition") {
                editorCore?.goToDefinitionAtCursor()
            }
            .keyboardShortcut(.downArrow, modifiers: [.command, .control])
            
            Button("Go to Declaration") {
                editorCore?.goToDefinitionAtCursor()
            }
            
            Button("Go to Type Definition") {
                editorCore?.goToDefinitionAtCursor()
            }
            
            Button("Go to Implementation") {
                editorCore?.goToDefinitionAtCursor()
            }
            
            Button("Go to References") {
                // TODO: Implement references search
                print("Go to References - Not yet implemented")
            }
            .keyboardShortcut(.downArrow, modifiers: [.shift, .control])
            
            Divider()
            
            // MARK: - Line Navigation
            
            Button("Go to Line...") {
                editorCore?.toggleGoToLine()
            }
            .keyboardShortcut("g", modifiers: [.command])
            
            Divider()
            
            // MARK: - Navigation History
            
            Button("Go Back") {
                editorCore?.navigateBack()
            }
            .keyboardShortcut("-", modifiers: [.control])
            
            Button("Go Forward") {
                editorCore?.navigateForward()
            }
            .keyboardShortcut("=", modifiers: [.control, .shift])
            
            Divider()
            
            // MARK: - Editor Navigation
            
            Button("Next Editor") {
                editorCore?.nextTab()
            }
            .keyboardShortcut("]", modifiers: [.command, .shift])
            
            Button("Previous Editor") {
                editorCore?.previousTab()
            }
            .keyboardShortcut("[", modifiers: [.command, .shift])
        }
    }
}

// MARK: - FocusedValueKey Definition

/// Environment key for accessing EditorCore in focused views
struct EditorCoreKey: FocusedValueKey {
    typealias Value = EditorCore
}

extension FocusedValues {
    var editorCore: EditorCore? {
        get { self[EditorCoreKey.self] }
        set { self[EditorCoreKey.self] = newValue }
    }
}
